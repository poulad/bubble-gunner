function resizeCanvas(e,t){window.innerHeight<=window.innerWidth?e.height=e.width=window.innerHeight:e.height=e.width=window.innerWidth,e.width>1200&&(e.height=e.width=1200);var n=e.width/BubbleGunner.NormalWidth;t.scaleX=t.scaleY=n;var a=(window.innerHeight-e.height)/2;e.style.marginTop=a+"px"}function init(){BubbleGunner.canvas=document.getElementById("canvas");var e=new createjs.Stage(BubbleGunner.canvas);window.addEventListener("resize",resizeCanvas.bind(this,BubbleGunner.canvas,e),!1),resizeCanvas(BubbleGunner.canvas,e),new BubbleGunner.GameManager(e).startGame()}var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),BubbleGunner;!function(e){var t=createjs.Container,n=createjs.Event;e.NormalWidth=800,e.NormalHeight=800;var a=function(e){function t(t,n){for(var a=[],i=2;i<arguments.length;i++)a[i-2]=arguments[i];var r=e.call(this,t,void 0,void 0)||this;return r.toScene=n,r.startArgs=a,r}return __extends(t,e),t}(n);e.SceneEvent=a;var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.EventChangeScene="changeScene",t}(t);e.Scene=i;!function(e){e[e.Preload=0]="Preload",e[e.Menu=1]="Menu",e[e.Help=2]="Help",e[e.Game=3]="Game",e[e.GameOver=4]="GameOver"}(e.SceneType||(e.SceneType={}))}(BubbleGunner||(BubbleGunner={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),BubbleGunner;!function(e){!function(t){var n=createjs.Shape,a=createjs.Text,i=createjs.Tween,r=createjs.LoadQueue,o=createjs.Sound,s=function(t){function s(){var i=t.call(this)||this;return i._circle=new n,i._circle.graphics.setStrokeStyle(5).beginStroke("rgba(200, 200, 200, .4)").beginFill("lightblue").drawCircle(0,0,s.Radius),i._circle.x=e.NormalWidth/2,i._circle.y=e.NormalHeight/2,i._text=new a("0 %","40px Permanent Marker","#444"),i._text.x=i._text.y=-100,i.addChild(i._circle,i._text),i}return __extends(s,t),s.prototype.start=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.loader=new r(!0,"assets/"),e.loader.installPlugin(createjs.Sound),o.alternateExtensions=["mp3"],e.loader.on("progress",this.updateProgress,this),e.loader.on("complete",this.changeToMenuScene,this),e.loader.loadManifest([{id:"sound-button",src:"sounds/button.ogg"},{id:"dragon",src:"images/dragon.png"},{id:"dragon-hand",src:"images/dragon-hand.png"},{id:"volcano",src:"images/volcano.png"},{id:"heart",src:"images/heart.png"},{id:"menu-volcano",src:"images/volcano-menu.png"},{id:"menu-dragon",src:"images/dragon-menu.png"},{id:"menu-start",src:"images/start.png"},{id:"menu-help",src:"images/help.png"},{id:"help-guide",src:"images/help-guide.png"},{id:"back",src:"images/back.png"},{id:"pause",src:"images/pause.png"},{id:"refresh",src:"images/refresh.png"},{id:"scoresbar",src:"images/scoresbar.png"},{id:"game-lava",src:"images/lava.png"},{id:"game-animal0",src:"images/animal0.png"},{id:"game-animal1",src:"images/animal1.png"},{id:"game-animal2",src:"images/animal2.png"},{id:"game-animal3",src:"images/animal3.png"},{id:"game-bgm",src:"sounds/bgm.ogg"},{id:"game-bubble-shoot",src:"sounds/bubble-shoot.ogg"},{id:"game-lava-fall",src:"sounds/lava-fall.ogg"}])},s.prototype.updateProgress=function(t){var n=Math.floor(100*t.loaded),a=(this._circle.scaleX+10*n)/100;i.get(this._circle).to({scaleX:a,scaleY:a},150);this._text.text=n+" %",this._text.x=e.NormalWidth/2-this._text.getMeasuredWidth()/2,this._text.y=e.NormalHeight/2-this._text.getMeasuredHeight()/2},s.prototype.changeToMenuScene=function(){var t=this;i.removeTweens(this._circle),i.get(this._circle).to({scaleX:10,scaleY:10},200).call(function(){return setTimeout(function(){return t.dispatchEvent(new e.SceneEvent(e.Scene.EventChangeScene,e.SceneType.Menu))},400)})},s.Radius=50,s}(e.Scene);t.PreloadScene=s}(e.Menu||(e.Menu={}))}(BubbleGunner||(BubbleGunner={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),BubbleGunner;!function(e){!function(t){var n=createjs.Shape,a=createjs.Bitmap,i=createjs.Graphics,r=createjs.Tween,o=createjs.Sound,s=createjs.SpriteSheet,l=createjs.Sprite,c=createjs.Container,h=function(t){function h(){var r=t.call(this)||this,o=(new i).beginFill("lightblue").drawRect(0,0,e.NormalWidth,e.NormalHeight);r.addChild(new n(o));var c=new a(e.loader.getResult("menu-volcano"));r.addChild(c),r._btnStartGame=new a(e.loader.getResult("menu-start")),r._btnStartGame.regX=r._btnStartGame.image.width/2,r._btnStartGame.regY=r._btnStartGame.image.height/2,r._btnStartGame.x=e.NormalWidth/2,r._btnStartGame.y=e.NormalHeight/2,r._btnStartGame.cursor="pointer",r._btnStartGame.on("click",r.onStartButtonClick,r),r.addChild(r._btnStartGame),setInterval(r.pulse.bind(r),120),r._btnHelp=new a(e.loader.getResult("menu-help")),r._btnHelp.x=e.NormalWidth-r._btnHelp.image.width-50,r._btnHelp.y=50,r._btnHelp.cursor="pointer",r._btnHelp.on("click",r.onHelpButtonClick,r),r.addChild(r._btnHelp);var h={images:[e.loader.getResult("menu-dragon")],frames:[[0,0,552,674],[552,0,552,674],[0,0,552,674],[0,674,552,674],[552,674,552,674]],framerate:4,animations:{cheer:[0,2,"run"],runCheer:[3,4,"cheer"],run:[3,4]}};r._dragon=new l(new s(h)),r._dragon.regX=226,r._dragon.regY=337;return r._dragon.x=6*e.NormalWidth/9,r._dragon.y=e.NormalHeight-190,r._dragon.scaleX=r._dragon.scaleY=.4,r.addChild(r._dragon),r}return __extends(h,t),h.prototype.start=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._dragon.on("animationend",this.moveDragon,this),this._dragon.gotoAndPlay("run"),this.moveDragon(void 0)},h.prototype.onStartButtonClick=function(){var t=this;o.play("sound-button"),r.get(this).to({alpha:0,scaleX:10,scaleY:10},2e3).call(function(){t.dispatchEvent(new e.SceneEvent(e.Scene.EventChangeScene,e.SceneType.Game))})},h.prototype.onHelpButtonClick=function(){o.play("sound-button"),this.dispatchEvent(new e.SceneEvent(e.Scene.EventChangeScene,e.SceneType.Help))},h.prototype.moveDragon=function(t){var n=this;if(!t||"cheer"===t.name){console.debug("Dragon running to other side");var a=this._dragon.scaleX>0?3*e.NormalWidth/9:6*e.NormalWidth/9;r.get(this._dragon).to({x:a},2500).call(function(){n._dragon.gotoAndPlay("cheer"),n._dragon.scaleX*=-1})}},h.prototype.pulse=function(){var e=this._btnStartGame.scaleX+.05;e>=1.2&&(e=1),r.get(this._btnStartGame).to({scaleX:e,scaleY:e},110);var t=this._btnHelp.alpha-.08;t<.9&&(t=1),r.get(this._btnHelp).to({alpha:t},110)},h.prototype.createStartGameButton=function(){this._btnStartGame2=new c;var t=new n;t.graphics.beginFill("orange").beginStroke("#A88").setStrokeStyle(6).drawRoundRect(0,0,200,100,10),this._btnStartGame2.addChild(t),this._btnStartGame2.regX=100,this._btnStartGame2.regY=50,this._btnStartGame2.x=e.NormalWidth/2,this._btnStartGame2.y=e.NormalHeight/2,this._btnStartGame2.cursor="pointer",this._btnStartGame2.on("click",this.onStartButtonClick,this),this.addChild(this._btnStartGame2)},h}(e.Scene);t.MenuScene=h}(e.Menu||(e.Menu={}))}(BubbleGunner||(BubbleGunner={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),BubbleGunner;!function(e){!function(t){var n=createjs.Bitmap,a=createjs.Sound,i=createjs.Shape,r=function(t){function r(){var a=t.call(this)||this,r=new i;r.graphics.beginFill("lightblue").drawRect(0,0,e.NormalWidth,e.NormalHeight),a.addChild(r);var o=new n(e.loader.getResult("back"));o.x=30,o.y=30,o.on("click",a.dispatchBackToMenuEvent,a),o.cursor="pointer",o.scaleX=o.scaleY=1.5,a.addChild(o);var s=new n(e.loader.getResult("help-guide"));return s.scaleX=s.scaleY=.8,s.x=130,s.y=120,a.addChild(s),a}return __extends(r,t),r.prototype.start=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},r.prototype.dispatchBackToMenuEvent=function(){a.play("sound-button"),this.dispatchEvent(new e.SceneEvent(e.Scene.EventChangeScene,e.SceneType.Menu))},r}(e.Scene);t.HelpScene=r}(e.Help||(e.Help={}))}(BubbleGunner||(BubbleGunner={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),BubbleGunner;!function(e){!function(t){function n(e){return e[1].length>0}function a(e,t){return Math.sqrt(Math.pow(e.y-t.y,2)+Math.pow(e.x-t.x,2))}function i(e,t){return a(new g(e.x,e.y),new g(e.y,t.y))}function r(e,t,n){return Math.floor(1e3*a(e,t)/n)}var o=createjs.Shape,s=createjs.Tween,l=createjs.Container,c=createjs.Text,h=createjs.Bitmap,u=createjs.Ease,d=createjs.EventDispatcher,p=createjs.Sound;t.hasCollisions=n,t.getPointsDistance=a,t.getObjectsDistance=i,t.getTweenDurationMSecs=r;var g=function(){function e(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this.x=e,this.y=t}return e.prototype.toString=function(){return"("+this.x+" , "+this.y+")"},e}();t.Point=g;var _=function(t){function n(e){var a=t.call(this,n.getRandomAnimalImage())||this;return a.regX=a.regY=n.Radius,a.x=e.x,a.y=e.y,a.startPoint=e,a}return __extends(n,t),n.prototype.moveTo=function(e){return this.endPoint=e,s.get(this).to({x:this.endPoint.x,y:this.endPoint.y},r(this.startPoint,this.endPoint,n.Speed)).call(this.fallCallback.bind(this))},n.prototype.continueFall=function(){s.removeTweens(this);var t=new g(this.endPoint.x,e.NormalHeight);return this.moveTo(t)},n.prototype.fallCallback=function(){return s.get(this).to({alpha:.3},300).call(this.dispatchEvent.bind(this,n.EventFell))},n.getRandomAnimalImage=function(){var t=Math.floor(34234*Math.random())%4;return e.loader.getResult("game-animal"+t)},n.EventFell="fell",n.Radius=40,n.Speed=330,n}(h),v=function(t){function n(a){var i=t.call(this,e.loader.getResult("game-lava"))||this;return i.startPoint=new g(a,2*-n.Radius),i.regX=i.regY=n.Radius,i.x=i.startPoint.x,i.y=i.startPoint.y,i}return __extends(n,t),n.prototype.moveTo=function(e){var t=this;return this.endPoint=e,s.get(this).to({x:this.endPoint.x,y:this.endPoint.y},r(this.startPoint,this.endPoint,n.Speed)).call(function(){return t.dispatchEvent(new Event(n.EventFell))})},n.EventFell="fell",n.Radius=30,n.Speed=400,n}(h),f=function(t){function n(e,a){var i=t.call(this)||this;return i.containsAnimal=!1,i._pulseCount=0,i.graphics.beginFill("rgba(255, 255, 255, .1)").beginStroke("rgba(255, 255, 255, .8)").setStrokeStyle(2).drawCircle(0,0,n.Radius),i.startPoint=e,i.x=i.startPoint.x,i.y=i.startPoint.y,i.endPoint=a,i}return __extends(n,t),n.prototype.move=function(){return this.on("tick",this.handleTick,this),this.updateEndPoint(),s.get(this).to({x:this.endPoint.x,y:this.endPoint.y},r(this.startPoint,this.endPoint,n.Speed)).call(this.dispatchEvent.bind(this,new Event(n.EventAscended)))},n.prototype.takeAnimal=function(e){return this._animal=e,this.containsAnimal=!0,this.x=this._animal.x,this.y=this._animal.y,s.removeTweens(this),s.removeTweens(this._animal),this.scaleX=this.scaleY=1,this.startPoint=new g(this.x,this.y),this.endPoint=new g(this.x,-_.Radius),s.get(this).to({x:this.endPoint.x,y:this.endPoint.y},r(this.startPoint,this.endPoint,n.AscendingSpeed)).call(this.dispatchEvent.bind(this,new Event(n.EventRescuedAnimal)))},n.prototype.getAnimal=function(){return this._animal},n.prototype.pop=function(){return s.removeTweens(this),this.containsAnimal&&this._animal.continueFall(),s.get(this).to({alpha:0}).call(this.dispatchEvent.bind(this,new Event(n.EventPopped)))},n.prototype.handleTick=function(){(this.x<0-n.Radius*this.scaleX||e.NormalWidth+n.Radius*this.scaleX<this.x)&&this.dispatchEvent(new Event(n.EventAscended)),this.containsAnimal&&(this._animal.y=this.y),this.pulse()},n.prototype.pulse=function(){var e=.4*Math.cos(.1*this._pulseCount++)+.6;s.get(this).to({alpha:e}),this._pulseCount++},n.prototype.updateEndPoint=function(){var t=0;this.endPoint.y>=this.startPoint.y&&(t=e.NormalHeight);var n=(this.startPoint.y-this.endPoint.y)/(this.startPoint.x-this.endPoint.x),a=this.endPoint.y-n*this.endPoint.x;this.endPoint.y=t,this.endPoint.x=(this.endPoint.y-a)/n},n.EventPopped="popped",n.EventAscended="ascended",n.EventRescuedAnimal="rescued",n.Radius=46,n.Speed=450,n.AscendingSpeed=100,n}(o),m=(function(e){function t(){var t=e.call(this,"assets/images/dragon-hand.png")||this;return t.regX=426,t.regY=110,t}__extends(t,e)}(h),function(t){function n(){var n=t.call(this)||this;return n.originalWidth=140,n.originalHeight=408,n._canShoot=!0,n._body=new h(e.loader.getResult("dragon")),n._hand=new h(e.loader.getResult("dragon-hand")),n._hand.regX=426,n._hand.regY=110,n._hand.x=250,n._hand.y=180,n.addChild(n._body,n._hand),n}return __extends(n,t),n.prototype.shootBubbleTo=function(e){if(this._canShoot){this.aimGunToPoint(e);var t=this.getGunMuzzleStagePoint(),a=new f(t,e);console.debug("Shooting bubble from: "+t);var i=a.scaleX;return a.scaleX=a.scaleY=.1,s.get(a).to({scaleX:i,scaleY:i},150,u.bounceOut),this.setGunFireDelay(n.FireRate),a}},n.prototype.setGunFireDelay=function(e){var t=this;clearTimeout(this._gunFireTimeoutHandle),this._canShoot=!1,this._gunFireTimeoutHandle=setTimeout(function(){void 0!=t&&(t._canShoot=!0)},e)},n.prototype.aimGun=function(e){var t=e.target,n=new g(e.stageX/t.scaleX,e.stageY/t.scaleY);this.aimGunToPoint(n)},n.prototype.isReadyToShoot=function(){return this._canShoot},n.prototype.aimGunToPoint=function(e){var t=this.getHandRegStagePoint();t.x<e.x?this.scaleX=-Math.abs(this.scaleX):this.scaleX=Math.abs(this.scaleX),t=this.getHandRegStagePoint();var n=e.y-t.y,a=e.x-t.x,i=Math.atan(n/a)/Math.PI*180;this.scaleX<0&&(i*=-1),i<-10&&(i=-10),this._hand.rotation=i},n.prototype.getHandRegStagePoint=function(){return new g(this.x+this._hand.x*this.scaleX,this.y+this._hand.y*this.scaleY)},n.prototype.getGunMuzzleStagePoint=function(){var e=new g,t=Math.PI+this._hand.rotation*Math.PI/180;this.scaleX<0&&(t=2*Math.PI-t);var n=426*this.scaleX,a=this.getHandRegStagePoint();return e.x=a.x+n*Math.cos(t),e.y=a.y+n*Math.sin(t),e},n.FireRate=650,n}(l)),b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.currentLevel=1,t}return __extends(t,e),t.prototype.getLevelMaxScore=function(e){return void 0==e&&(e=this.currentLevel),t.Level1MaxScore*e},t.prototype.setScore=function(e){this.currentLevel<3&&e>this.getLevelMaxScore()&&(this.currentLevel++,this.dispatchEvent(new Event(t.EventLevelChanged)))},t.EventLevelChanged="levelChanged",t.Level1MaxScore=4,t}(d),y=function(t){function n(n,a,i){void 0===a&&(a=0),void 0===i&&(i=4);var r=t.call(this)||this;r._levelManager=n,r._score=a,r._remainingLives=i,r._hearts=[];r._mask=new h(e.loader.getResult("scoresbar")),r.addChild(r._mask),r.setChildIndex(r._mask,2),r._bar=new o,r._bar.graphics.beginFill("yellow").drawRect(0,0,.72,r._mask.getBounds().height-6),r._bar.scaleX=0,r._bar.x=3,r._bar.y=3,r.addChild(r._bar),r.setChildIndex(r._bar,1),r._scoreText=new c(r._score.toString(),"20px Permanent Marker","white"),r._scoreText.x=r._mask.getBounds().width+10,r.addChild(r._scoreText),r.setChildIndex(r._scoreText,1);for(var s=0;s<i;s++){var l=new h(e.loader.getResult("heart"));l.scaleX=l.scaleY=.3,l.x=20*s,l.y=r._mask.getBounds().height+8,r._hearts.push(l),r.addChild(l)}return r}return __extends(n,t),n.prototype.increaseScore=function(){this.setScore(this._score+1)},n.prototype.decreaseRemainingLives=function(){this.setRemainingLives(this._remainingLives-1)},n.prototype.setScore=function(e){this._score=e,this._levelManager.setScore(this._score);var t=this._score/this._levelManager.getLevelMaxScore()*100;t=t>=100?100:t,s.get(this._bar).to({scaleX:t},300),this._scoreText.text=this._score.toString()},n.prototype.getScore=function(){return this._score},n.prototype.setRemainingLives=function(e){var t=this;this._remainingLives=e,this._hearts.filter(function(t,n){return n+1>e}).forEach(function(e){s.get(e).to({alpha:0,x:-50},300).call(function(){t.removeChild(e),t._hearts.pop(),console.debug("Hearts left: "+t._hearts.length),t._hearts.length<=0&&t.dispatchEvent(new Event(n.EventNoLifeLeft))})})},n.prototype.getRemainingLives=function(){return this._remainingLives},n.EventNoLifeLeft="noLifeLeft",n}(l),S=function(t){function r(){var n=t.call(this)||this;n._levelManager=new b,n._animals=[],n._bubbles=[],n._lavaPieces=[],n._isShapesLockFree=!0;var a=new o;a.graphics.beginFill("#222").drawRect(0,0,e.NormalWidth,e.NormalHeight),a.x=a.y=0,n.addChild(a);var i=new h(e.loader.getResult("volcano"));return n.addChild(i),n._scoresBar=new y(n._levelManager),n._scoresBar.x=10,n._scoresBar.y=10,n._scoresBarListener=n._scoresBar.on(y.EventNoLifeLeft,n.changeGameScene.bind(n,e.SceneType.GameOver)),n.addChild(n._scoresBar),n.setChildIndex(n._scoresBar,3),n._dragon=new m,n._dragon.scaleX=n._dragon.scaleY=.3,n._dragon.x=e.NormalWidth/2,n._dragon.y=e.NormalHeight-n._dragon.originalHeight*n._dragon.scaleY-40,n.addChild(n._dragon),n.setChildIndex(n._dragon,3),n._pauseButton=new h(e.loader.getResult("pause")),n._pauseButton.x=30,n._pauseButton.y=e.NormalHeight-n._pauseButton.getBounds().height-30,n._pauseButton.cursor="pointer",n._pauseButtonListener=n._pauseButton.on("click",function(){p.play("sound-button"),n.changeGameScene(e.SceneType.Menu)},n),n.addChild(n._pauseButton),n.setChildIndex(n._pauseButton,3),n._tickListener=n.on("tick",n.handleTick,n),n}return __extends(r,t),r.prototype.start=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.alpha=-1,this.scaleX=this.scaleY=10,s.get(this).to({scaleX:1,scaleY:1,alpha:1},1e3),this._mouseMoveListener=this.stage.on("stagemousemove",this._dragon.aimGun,this._dragon),this._mouseUpListener=this.stage.on("stagemouseup",this.handleClick,this),this._levelListener=this._levelManager.on(b.EventLevelChanged,this.showLevelChangedDemo,this),this.playBackgroundMusic(),this.startRain()},r.prototype.startRain=function(){this._animalRainInterval=setInterval(this.handleAnimalRainInterval.bind(this),2300),this._lavaRainInterval=setInterval(this.handleLavaRainInterval.bind(this),3500)},r.prototype.stopRain=function(){clearInterval(this._animalRainInterval),clearInterval(this._lavaRainInterval)},r.prototype.changeGameScene=function(t){switch(this.off("tick",this._tickListener),this.stage.off("stagemousemove",this._mouseMoveListener),this.stage.off("stagemouseup",this._mouseUpListener),this._scoresBar.off(y.EventNoLifeLeft,this._scoresBarListener),this._bgMusic.off("complete",this._bgMusicListener),this._pauseButton.off("click",this._pauseButtonListener),this._levelManager.off(b.EventLevelChanged,this._levelListener),this.stopRain(),this._bgMusic.stop(),this.removeAllChildren(),this._bubbles.length=this._animals.length=this._lavaPieces.length=0,t){case e.SceneType.Menu:this.dispatchEvent(new e.SceneEvent(e.Scene.EventChangeScene,e.SceneType.Menu));break;case e.SceneType.GameOver:this.dispatchEvent(new e.SceneEvent(e.Scene.EventChangeScene,e.SceneType.GameOver));break;default:throw new Error("Invalid scene type: "+t)}},r.prototype.handleAnimalRainInterval=function(){var t=this,n=new _(new g(r.getRandomX(),0));this.lockShapes(function(){t._animals.push(n)}),this.addChild(n),this.setChildIndex(n,2),console.debug(this._animals),n.on(_.EventFell,this.handleAnimalFall,this),n.moveTo(new g(r.getRandomX(),e.NormalHeight))},r.prototype.handleLavaRainInterval=function(){var t=this,n=function(){var n=new v(r.getRandomX());t.lockShapes(function(){return t._lavaPieces.push(n)}),t.addChild(n),t.setChildIndex(n,2),console.debug(t._lavaPieces),n.on(v.EventFell,function(){return t.removeShape(n)},t),n.moveTo(new g(r.getRandomX(),e.NormalHeight+v.Radius)),p.play("game-lava-fall")};switch(this._levelManager.currentLevel){case 1:break;case 2:n();break;case 3:n(),setTimeout(n,1200);break;default:throw"Invalid level: "+this._levelManager.currentLevel}},r.prototype.handleClick=function(e){var t=this;if(this._dragon.isReadyToShoot()){var n=this._pauseButton.globalToLocal(this.stage.mouseX,this.stage.mouseY);if(!this._pauseButton.hitTest(n.x,n.y)){var a=new g(e.stageX/this.stage.scaleX,e.stageY/this.stage.scaleY),i=this._dragon.shootBubbleTo(a);this.lockShapes(function(){t._bubbles.push(i)}),this.addChild(i),this.setChildIndex(i,2),console.debug(this._bubbles),i.on(f.EventPopped,function(){return t.removeShape(i)},this),i.on(f.EventAscended,function(){return t.removeShape(i)},this),i.on(f.EventRescuedAnimal,function(){t._scoresBar.increaseScore(),t.removeShape(i.getAnimal(),i)},this),p.play("game-bubble-shoot"),i.move()}}},r.prototype.playBackgroundMusic=function(){this._bgMusic=p.play("game-bgm"),this._bgMusicListener=this._bgMusic.on("complete",this.playBackgroundMusic,this),this._bgMusic.volume=.5,this._bgMusic.pan=.5},r.prototype.handleAnimalFall=function(e){var t=e.target;this._scoresBar.decreaseRemainingLives(),this.removeShape(t)},r.prototype.showLevelChangedDemo=function(){var t=this;this.stopRain();var n;n=setInterval(function(){0===t._animals.length&&(clearInterval(n),t._levelText=new c(void 0,"bold 24px Permanent Marker","yellow"),t._levelText.text="Level "+t._levelManager.currentLevel,t._levelText.regX=t._levelText.getMeasuredWidth()/2,t._levelText.regY=t._levelText.getMeasuredHeight()/2,t._levelText.x=e.NormalWidth/2,t._levelText.y=e.NormalHeight/2,s.get(t._levelText).to({scaleX:5,scaleY:5,alpha:0},2500).call(function(){t.removeChild(t._levelText),t.startRain()}),t.addChild(t._levelText))},200)},r.prototype.removeShape=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.lockShapes(function(){for(var n=0,a=t;n<a.length;n++)!function(t){e.removeChild(t),t instanceof f?(e._bubbles=e._bubbles.filter(function(e){return e!==t&&void 0!=e}),console.debug(e._bubbles)):t instanceof _?(e._animals=e._animals.filter(function(e){return e!==t&&void 0!=e}),console.debug(e._animals)):t instanceof v?(e._lavaPieces=e._lavaPieces.filter(function(e){return e!==t&&void 0!=e}),console.debug(e._lavaPieces)):console.warn("Unknown type to remove: "+t)}(a[n])})},r.prototype.handleTick=function(){var e=this;this._isShapesLockFree&&this.lockShapes(function(){e._bubbles.filter(e.isCollidingWithAnyLava(e._lavaPieces)).forEach(function(t){t.pop(),console.debug("hit lava!"),e._dragon.setGunFireDelay(1500)}),e._bubbles.filter(e.isNotCollidingWithOtherBubbles(e._bubbles)).map(function(t){return[t,e.findAnimalsCollidingWithBubble(t,e._animals)]}).filter(n).map(function(e){return[e[0],e[1][0]]}).forEach(function(e){return e[0].takeAnimal(e[1])})})},r.getRandomX=function(){return 324627938*Math.random()%e.NormalWidth},r.prototype.lockShapes=function(e){this._isShapesLockFree=!1,e(),this._isShapesLockFree=!0},r.prototype.isNotCollidingWithOtherBubbles=function(e){var t=2*f.Radius;return function(n){var i=new g(n.x,n.y);return 0===e.filter(function(e){return e!==n}).filter(function(e){var n=new g(e.x,e.y);return a(i,n)<=t}).length}},r.prototype.findAnimalsCollidingWithBubble=function(e,t){var n=f.Radius+_.Radius,i=new g(e.x,e.y);return t.filter(function(e){var t=new g(e.x,e.y);return a(i,t)<=n})},r.prototype.isCollidingWithAnyLava=function(e){var t=f.Radius+v.Radius;return function(n){return e.some(function(e){return i(n,e)<=t})}},r}(e.Scene);t.GameScene=S}(e.Game||(e.Game={}))}(BubbleGunner||(BubbleGunner={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),BubbleGunner;!function(e){!function(t){var n=createjs.Bitmap,a=createjs.Tween,i=createjs.Text,r=createjs.Sound,o=function(t){function o(){var a=t.call(this)||this;a._pulseCount=0;var r=new i("GAME OVER","bold 80px Arial","#f57"),o=r.getBounds();return r.x=e.NormalWidth/2-o.width/2,r.y=30,a.addChild(r),a._refreshButton=new n(e.loader.getResult("refresh")),a._refreshButton.regX=a._refreshButton.getBounds().width/2,a._refreshButton.regY=a._refreshButton.getBounds().height/2,a._refreshButton.x=e.NormalWidth/2,a._refreshButton.y=e.NormalHeight/2,a._refreshButton.on("click",a.dispatchPlayGameEvent,a),a._refreshButton.cursor="pointer",a.addChild(a._refreshButton),a}return __extends(o,t),o.prototype.start=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._pulseIntervalHandle=setInterval(this.pulse.bind(this),60)},o.prototype.dispatchPlayGameEvent=function(){r.play("sound-button"),clearInterval(this._pulseIntervalHandle),this.dispatchEvent(new e.SceneEvent(e.Scene.EventChangeScene,e.SceneType.Game))},o.prototype.pulse=function(){var e=.4*Math.cos(.1*this._pulseCount++)+2;a.get(this._refreshButton).to({scaleX:e,scaleY:e,rotation:5*-this._pulseCount},30),this._pulseCount++},o}(e.Scene);t.GameOverScene=o}(e.GameOver||(e.GameOver={}))}(BubbleGunner||(BubbleGunner={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),BubbleGunner;!function(e){var t=createjs.Ticker,n=createjs.Touch,a=createjs.EventDispatcher,i=e.Menu.MenuScene,r=e.Game.GameScene,o=e.Menu.PreloadScene,s=e.Help.HelpScene,l=e.GameOver.GameOverScene,c=function(a){function c(e){var t=a.call(this)||this;return t._stage=e,t}return __extends(c,a),c.prototype.startGame=function(){t.framerate=60,t.addEventListener("tick",this._stage),n.enable(this._stage),this._stage.enableMouseOver(10),this.startNewScene(e.SceneType.Preload)},c.prototype.startNewScene=function(t){for(var n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];this._stage.removeAllChildren(),this._currentScene=c.createScene(t),this._stage.addChild(this._currentScene),this._currentScene.on(e.Scene.EventChangeScene,this.changeSceneHandler,this),this._currentScene.start()},c.prototype.changeSceneHandler=function(e){this.startNewScene(e.toScene,e.startArgs)},c.createScene=function(t){var n;switch(t){case e.SceneType.Preload:n=new o;break;case e.SceneType.Menu:n=new i;break;case e.SceneType.Help:n=new s;break;case e.SceneType.Game:n=new r;break;case e.SceneType.GameOver:n=new l;break;default:throw new Error("Scene type "+t+" not implemented yet")}return n},c}(a);e.GameManager=c}(BubbleGunner||(BubbleGunner={})),window.addEventListener("load",init);