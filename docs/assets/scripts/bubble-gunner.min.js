function resizeCanvas(e,t){window.innerHeight<=window.innerWidth?e.height=e.width=window.innerHeight:e.height=e.width=window.innerWidth,e.width>1200&&(e.height=e.width=1200);var n=e.width/BubbleGunner.NormalWidth;t.scaleX=t.scaleY=n;var r=(window.innerHeight-e.height)/2;e.style.marginTop=r+"px"}function init(){BubbleGunner.canvas=document.getElementById("canvas");var e=new createjs.Stage(BubbleGunner.canvas);window.addEventListener("resize",resizeCanvas.bind(this,BubbleGunner.canvas,e),!1),resizeCanvas(BubbleGunner.canvas,e),new BubbleGunner.GameManager(e).startGame()}var BubbleGunner;!function(e){e.NormalWidth=800,e.NormalHeight=800}(BubbleGunner||(BubbleGunner={}));var BubbleGunner;!function(e){var t=function(){function e(t,n){void 0===n&&(n=null),this._scope=t,this._name=n,this._intervalHandlers=[],this._timeoutHandlers=[],this._eventHandlerRemoverCallbacks=[],void 0!=this._name&&(this._name="GC "+e.Id,e.Id++)}return e.prototype.registerEventListener=function(e,t,n,r){void 0===r&&(r=this._scope);var a=e.on(t,n,r);return this._eventHandlerRemoverCallbacks.push(function(){void 0!=e&&void 0!=a&&e.off(t,a)}),a},e.prototype.registerTimeout=function(e,t){var n=setTimeout(e,t);return this._timeoutHandlers.push(n),n},e.prototype.registerInterval=function(e,t){var n=setInterval(e,t);return this._intervalHandlers.push(n),n},e.prototype.disposeInterval=function(e){if(!this._intervalHandlers.some(function(t){return t===e}))throw new Error("Interval handler is not registered with garbage collector.");clearInterval(e),this._intervalHandlers=this._intervalHandlers.filter(function(t){return t!==e})},e.prototype.disposeAll=function(){this._timeoutHandlers.forEach(function(e){return clearTimeout(e)}),this._timeoutHandlers=[],this._intervalHandlers.forEach(function(e){return clearInterval(e)}),this._intervalHandlers=[],this._eventHandlerRemoverCallbacks.forEach(function(e){return e()}),this._eventHandlerRemoverCallbacks=[]},e.Id=1,e}();e.GarbageCollector=t}(BubbleGunner||(BubbleGunner={}));var BubbleGunner;!function(e){!function(e){e[e.Preload=0]="Preload",e[e.Menu=1]="Menu",e[e.Help=2]="Help",e[e.Game=3]="Game",e[e.GameOver=4]="GameOver"}(e.SceneType||(e.SceneType={}))}(BubbleGunner||(BubbleGunner={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),BubbleGunner;!function(e){var t=function(e){function t(t,n){for(var r=[],a=2;a<arguments.length;a++)r[a-2]=arguments[a];var i=e.call(this,t,void 0,void 0)||this;return i.toScene=n,i.startArgs=r,i}return __extends(t,e),t}(createjs.Event);e.SceneEvent=t}(BubbleGunner||(BubbleGunner={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),BubbleGunner;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.EventChangeScene="changeScene",t}(createjs.Container);e.SceneBase=t}(BubbleGunner||(BubbleGunner={}));var BubbleGunner;!function(e){function t(t){return void 0==o&&(o=e.loader.getResult("j:audiosprite")),o.data.audioSprite.filter(function(e){return e.id===t}).map(function(e){return[e.startTime,e.duration]})[0]}var n=createjs.Sound,r=createjs.PlayPropsConfig;e.ImageAsset||(e.ImageAsset={});var a;!function(e){e[e.ButtonClick=0]="ButtonClick",e[e.GameBgMusic=1]="GameBgMusic",e[e.LavaPieceFall=2]="LavaPieceFall",e[e.BubbleShoot=3]="BubbleShoot",e[e.BubblePop=4]="BubblePop",e[e.Volcano=5]="Volcano",e[e.Score=6]="Score"}(a=e.SoundAsset||(e.SoundAsset={}));var i=[[a.ButtonClick,"menu-button"],[a.GameBgMusic,"game-bgm"],[a.Volcano,"game-volcano"],[a.LavaPieceFall,"game-lava-fall"],[a.BubbleShoot,"game-bubble-shoot"],[a.BubblePop,"game-bubble-pop"],[a.Score,"game-score"]];e.getImage=function(e){},e.playSound=function(e){var a=t(i.filter(function(t){return t[0]===e})[0][1]);return n.play("s:audiosprite",(new r).set({startTime:a[0],duration:a[1]}))};var o}(BubbleGunner||(BubbleGunner={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),BubbleGunner;!function(e){!function(t){var n=createjs.Shape,r=createjs.Text,a=createjs.Tween,i=createjs.LoadQueue,o=createjs.Sound,s=function(t){function s(){var a=t.call(this)||this;return a._circle=new n,a._circle.graphics.setStrokeStyle(5).beginStroke("rgba(200, 200, 200, .4)").beginFill("lightblue").drawCircle(0,0,s.Radius),a._circle.x=e.NormalWidth/2,a._circle.y=e.NormalHeight/2,a._text=new r("0 %","40px Permanent Marker","#444"),a._text.x=a._text.y=-100,a.addChild(a._circle,a._text),a}return __extends(s,t),s.prototype.start=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.loader=new i(!0,"assets/"),e.loader.installPlugin(createjs.Sound),o.alternateExtensions=["mp3"],e.loader.on("progress",this.updateProgress,this),e.loader.on("complete",this.changeToMenuScene,this),e.loader.loadManifest([{id:"j:audiosprite",src:"sounds/audiosprite.json"},{id:"s:audiosprite",src:"sounds/audiosprite.ogg"},{id:"dragon",src:"images/dragon.png"},{id:"dragon-hand",src:"images/dragon-hand.png"},{id:"volcano",src:"images/volcano.png"},{id:"heart",src:"images/heart.png"},{id:"menu-volcano",src:"images/volcano-menu.png"},{id:"menu-dragon",src:"images/dragon-menu.png"},{id:"menu-start",src:"images/start.png"},{id:"menu-help",src:"images/help.png"},{id:"help-guide",src:"images/help-guide.png"},{id:"back",src:"images/back.png"},{id:"pause",src:"images/pause.png"},{id:"refresh",src:"images/refresh.png"},{id:"scoresbar",src:"images/scoresbar.png"},{id:"game-lava",src:"images/lava.png"},{id:"game-animal0",src:"images/animal0.png"},{id:"game-animal1",src:"images/animal1.png"},{id:"game-animal2",src:"images/animal2.png"},{id:"game-animal3",src:"images/animal3.png"},{id:"game-pterodactyl",src:"images/pterodactyl.png"}])},s.prototype.updateProgress=function(t){var n=Math.floor(100*t.loaded),r=(this._circle.scaleX+10*n)/100;a.get(this._circle).to({scaleX:r,scaleY:r},150);this._text.text=n+" %",this._text.x=e.NormalWidth/2-this._text.getMeasuredWidth()/2,this._text.y=e.NormalHeight/2-this._text.getMeasuredHeight()/2},s.prototype.changeToMenuScene=function(){var t=this;a.removeTweens(this._circle),a.get(this._circle).to({scaleX:10,scaleY:10},200).call(function(){return setTimeout(function(){return t.dispatchEvent(new e.SceneEvent(e.SceneBase.EventChangeScene,e.SceneType.Menu))},400)})},s.Radius=50,s}(e.SceneBase);t.PreloadScene=s}(e.Menu||(e.Menu={}))}(BubbleGunner||(BubbleGunner={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),BubbleGunner;!function(e){!function(t){var n=createjs.Shape,r=createjs.Bitmap,a=createjs.Graphics,i=createjs.Tween,o=createjs.SpriteSheet,s=createjs.Sprite,c=createjs.Container,u=function(t){function u(){var i=t.call(this)||this,c=(new a).beginFill("lightblue").drawRect(0,0,e.NormalWidth,e.NormalHeight);i.addChild(new n(c));var u=new r(e.loader.getResult("menu-volcano"));i.addChild(u),i._btnStartGame=new r(e.loader.getResult("menu-start")),i._btnStartGame.regX=i._btnStartGame.image.width/2,i._btnStartGame.regY=i._btnStartGame.image.height/2,i._btnStartGame.x=e.NormalWidth/2,i._btnStartGame.y=e.NormalHeight/2,i._btnStartGame.cursor="pointer",i._btnStartGame.on("click",i.onStartButtonClick,i),i.addChild(i._btnStartGame),setInterval(i.pulse.bind(i),120),i._btnHelp=new r(e.loader.getResult("menu-help")),i._btnHelp.x=e.NormalWidth-i._btnHelp.image.width-50,i._btnHelp.y=50,i._btnHelp.cursor="pointer",i._btnHelp.on("click",i.onHelpButtonClick,i),i.addChild(i._btnHelp);var l={images:[e.loader.getResult("menu-dragon")],frames:[[0,0,552,674],[552,0,552,674],[0,0,552,674],[0,674,552,674],[552,674,552,674]],framerate:4,animations:{cheer:[0,2,"run"],runCheer:[3,4,"cheer"],run:[3,4]}};i._dragon=new s(new o(l)),i._dragon.regX=226,i._dragon.regY=337;return i._dragon.x=6*e.NormalWidth/9,i._dragon.y=e.NormalHeight-190,i._dragon.scaleX=i._dragon.scaleY=.4,i.addChild(i._dragon),i}return __extends(u,t),u.prototype.start=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._dragon.on("animationend",this.moveDragon,this),this._dragon.gotoAndPlay("run"),this.moveDragon(void 0)},u.prototype.onStartButtonClick=function(){var t=this;e.playSound(e.SoundAsset.ButtonClick),i.get(this).to({alpha:0,scaleX:10,scaleY:10},2e3).call(function(){t.dispatchEvent(new e.SceneEvent(e.SceneBase.EventChangeScene,e.SceneType.Game))})},u.prototype.onHelpButtonClick=function(){e.playSound(e.SoundAsset.ButtonClick),this.dispatchEvent(new e.SceneEvent(e.SceneBase.EventChangeScene,e.SceneType.Help))},u.prototype.moveDragon=function(t){var n=this;if(!t||"cheer"===t.name){var r=this._dragon.scaleX>0?3*e.NormalWidth/9:6*e.NormalWidth/9;i.get(this._dragon).to({x:r},2500).call(function(){n._dragon.gotoAndPlay("cheer"),n._dragon.scaleX*=-1})}},u.prototype.pulse=function(){var e=this._btnStartGame.scaleX+.05;e>=1.2&&(e=1),i.get(this._btnStartGame).to({scaleX:e,scaleY:e},110);var t=this._btnHelp.alpha-.08;t<.9&&(t=1),i.get(this._btnHelp).to({alpha:t},110)},u.prototype.createStartGameButton=function(){this._btnStartGame2=new c;var t=new n;t.graphics.beginFill("orange").beginStroke("#A88").setStrokeStyle(6).drawRoundRect(0,0,200,100,10),this._btnStartGame2.addChild(t),this._btnStartGame2.regX=100,this._btnStartGame2.regY=50,this._btnStartGame2.x=e.NormalWidth/2,this._btnStartGame2.y=e.NormalHeight/2,this._btnStartGame2.cursor="pointer",this._btnStartGame2.on("click",this.onStartButtonClick,this),this.addChild(this._btnStartGame2)},u}(e.SceneBase);t.MenuScene=u}(e.Menu||(e.Menu={}))}(BubbleGunner||(BubbleGunner={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),BubbleGunner;!function(e){!function(t){var n=createjs.Bitmap,r=createjs.Shape,a=function(t){function a(){var a=t.call(this)||this,i=new r;i.graphics.beginFill("lightblue").drawRect(0,0,e.NormalWidth,e.NormalHeight),a.addChild(i);var o=new n(e.loader.getResult("back"));o.x=30,o.y=30,o.on("click",a.dispatchBackToMenuEvent,a),o.cursor="pointer",o.scaleX=o.scaleY=1.5,a.addChild(o);var s=new n(e.loader.getResult("help-guide"));return s.scaleX=s.scaleY=.8,s.x=130,s.y=120,a.addChild(s),a}return __extends(a,t),a.prototype.start=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},a.prototype.dispatchBackToMenuEvent=function(){e.playSound(e.SoundAsset.ButtonClick),this.dispatchEvent(new e.SceneEvent(e.SceneBase.EventChangeScene,e.SceneType.Menu))},a}(e.SceneBase);t.HelpScene=a}(e.Help||(e.Help={}))}(BubbleGunner||(BubbleGunner={}));var BubbleGunner;!function(e){!function(e){function t(e,t){return Math.sqrt(Math.pow(e.y-t.y,2)+Math.pow(e.x-t.x,2))}var n=createjs.Point,r=0;e.getPointsDistance=t,e.getObjectsDistance=function(e,r){return t(new n(e.x,e.y),new n(r.x,r.y))},e.getTweenDurationMSecs=function(e,n,r){return Math.floor(1e3*t(e,n)/r)},e.generateId=function(){return++r}}(e.Game||(e.Game={}))}(BubbleGunner||(BubbleGunner={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),BubbleGunner;!function(e){!function(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.currentLevel=1,t}return __extends(t,e),t.prototype.getLevelMaxScore=function(e){return void 0==e&&(e=this.currentLevel),t.Level1MaxScore*e},t.prototype.setScore=function(e){this.currentLevel<3&&e>this.getLevelMaxScore()&&(this.currentLevel++,this.dispatchEvent(new Event(t.EventLevelChanged)))},t.EventLevelChanged="levelChanged",t.Level1MaxScore=4,t}(createjs.EventDispatcher);e.LevelManager=t}(e.Game||(e.Game={}))}(BubbleGunner||(BubbleGunner={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),BubbleGunner;!function(e){!function(t){var n=createjs.Shape,r=createjs.Tween,a=createjs.Container,i=createjs.Text,o=createjs.Bitmap,s=function(a){function s(r,s,c){void 0===s&&(s=0),void 0===c&&(c=4);var u=a.call(this)||this;u._levelManager=r,u._score=s,u._remainingLives=c,u._hearts=[],u.name="Scores bar "+t.generateId();u._mask=new o(e.loader.getResult("scoresbar")),u.addChild(u._mask),u.setChildIndex(u._mask,2),u._bar=new n,u._bar.graphics.beginFill("yellow").drawRect(0,0,.72,u._mask.getBounds().height-6),u._bar.scaleX=0,u._bar.x=3,u._bar.y=3,u.addChild(u._bar),u.setChildIndex(u._bar,1),u._scoreText=new i(u._score.toString(),"20px Permanent Marker","white"),u._scoreText.x=u._mask.getBounds().width+10,u.addChild(u._scoreText),u.setChildIndex(u._scoreText,1);for(var l=0;l<c;l++){var h=new o(e.loader.getResult("heart"));h.scaleX=h.scaleY=.3,h.x=20*l,h.y=u._mask.getBounds().height+8,u._hearts.push(h),u.addChild(h)}return u}return __extends(s,a),s.prototype.increaseScore=function(){this.setScore(this._score+1),e.playSound(e.SoundAsset.Score)},s.prototype.decreaseRemainingLives=function(){this.setRemainingLives(this._remainingLives-1)},s.prototype.setScore=function(e){this._score=e,this._levelManager.setScore(this._score);var t=this._score/this._levelManager.getLevelMaxScore()*100;t=t>=100?100:t,r.get(this._bar).to({scaleX:t},300),this._scoreText.text=this._score.toString()},s.prototype.getScore=function(){return this._score},s.prototype.setRemainingLives=function(e){var t=this;this._remainingLives=e,this._hearts.filter(function(t,n){return n+1>e}).forEach(function(e){r.get(e).to({alpha:0,x:-50},300).call(function(){t.removeChild(e),t._hearts.pop(),console.debug("Hearts left: "+t._hearts.length),t._hearts.length<=0&&t.dispatchEvent(new Event(s.EventNoLifeLeft))})})},s.prototype.getRemainingLives=function(){return this._remainingLives},s.EventNoLifeLeft="noLifeLeft",s}(a);t.ScoresBar=s}(e.Game||(e.Game={}))}(BubbleGunner||(BubbleGunner={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),BubbleGunner;!function(e){!function(t){var n=createjs.Tween,r=createjs.Container,a=createjs.Bitmap,i=createjs.Ease,o=createjs.Point,s=function(r){function s(){var n=r.call(this)||this;return n.originalWidth=140,n.originalHeight=408,n._canShoot=!0,n.name="Dragon "+t.generateId(),n._body=new a(e.loader.getResult("dragon")),n._hand=new a(e.loader.getResult("dragon-hand")),n._hand.regX=426,n._hand.regY=110,n._hand.x=250,n._hand.y=180,n.addChild(n._body,n._hand),n}return __extends(s,r),s.prototype.shootBubbleTo=function(e){if(this._canShoot){this.aimGunToPoint(e);var r=this.getGunMuzzleStagePoint(),a=new t.Bubble(r,e);console.debug("Shooting bubble from: "+r);var o=a.scaleX;return a.scaleX=a.scaleY=.1,n.get(a).to({scaleX:o,scaleY:o},150,i.bounceOut),this.setGunFireDelay(s.FireRate),a}},s.prototype.setGunFireDelay=function(e){var t=this;clearTimeout(this._gunFireTimeoutHandle),this._canShoot=!1,this._gunFireTimeoutHandle=setTimeout(function(){void 0!=t&&(t._canShoot=!0)},e)},s.prototype.aimGun=function(e){var t=e.target,n=new o(e.stageX/t.scaleX,e.stageY/t.scaleY);this.aimGunToPoint(n)},s.prototype.isReadyToShoot=function(){return this._canShoot},s.prototype.aimGunToPoint=function(e){var t=this.getHandRegStagePoint();t.x<e.x?this.scaleX=-Math.abs(this.scaleX):this.scaleX=Math.abs(this.scaleX),t=this.getHandRegStagePoint();var n=e.y-t.y,r=e.x-t.x,a=Math.atan(n/r)/Math.PI*180;this.scaleX<0&&(a*=-1),a<-10&&(a=-10),this._hand.rotation=a},s.prototype.getHandRegStagePoint=function(){return new o(this.x+this._hand.x*this.scaleX,this.y+this._hand.y*this.scaleY)},s.prototype.getGunMuzzleStagePoint=function(){var e=new o,t=Math.PI+this._hand.rotation*Math.PI/180;this.scaleX<0&&(t=2*Math.PI-t);var n=426*this.scaleX,r=this.getHandRegStagePoint();return e.x=r.x+n*Math.cos(t),e.y=r.y+n*Math.sin(t),e},s.FireRate=650,s}(r);t.Dragon=s}(e.Game||(e.Game={}))}(BubbleGunner||(BubbleGunner={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),BubbleGunner;!function(e){!function(t){var n=createjs.Tween,r=createjs.Bitmap,a=createjs.Point,i=function(r){function i(n){var o=r.call(this,e.loader.getResult("game-lava"))||this;return o.name="Lava piece "+t.generateId(),o.startPoint=new a(n,2*-i.Radius),o.regX=o.regY=i.Radius,o.scaleX=o.scaleY=1,o.x=o.startPoint.x,o.y=o.startPoint.y,o}return __extends(i,r),i.prototype.moveTo=function(e){var r=this;return this.endPoint=e,n.get(this).to({x:this.endPoint.x,y:this.endPoint.y,rotation:180},t.getTweenDurationMSecs(this.startPoint,this.endPoint,i.Speed)).call(function(){return r.dispatchEvent(new Event(i.EventFell))})},i.EventFell="fell",i.Radius=30,i.Speed=470,i}(r);t.LavaPiece=i}(e.Game||(e.Game={}))}(BubbleGunner||(BubbleGunner={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),BubbleGunner;!function(e){!function(t){var n=createjs.Tween,r=createjs.Bitmap,a=createjs.Point,i=function(r){function i(e){var n=r.call(this,i.getRandomAnimalImage())||this;return n.isDying=!1,n.name="Animal "+t.generateId(),n.regX=n.regY=i.Radius,n.x=e.x,n.y=e.y,n.startPoint=e,n}return __extends(i,r),i.prototype.moveTo=function(e){return this.endPoint=e,n.get(this,{override:!0}).to({x:this.endPoint.x,y:this.endPoint.y},t.getTweenDurationMSecs(this.startPoint,this.endPoint,i.Speed)).call(this.fallCallback.bind(this))},i.prototype.continueFall=function(){return this.startPoint=new a(this.x,this.y),this.moveTo(new a(this.startPoint.x,e.NormalHeight))},i.prototype.fallCallback=function(){return this.isDying=!0,n.get(this,{override:!0}).to({alpha:0},500).call(this.dispatchEvent.bind(this,i.EventFell))},i.getRandomAnimalImage=function(){var t=Math.floor(34234*Math.random())%4;return e.loader.getResult("game-animal"+t)},i.EventFell="fell",i.Radius=40,i.Speed=230,i}(r);t.Animal=i}(e.Game||(e.Game={}))}(BubbleGunner||(BubbleGunner={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),BubbleGunner;!function(e){!function(t){var n=createjs.Shape,r=createjs.Tween,a=createjs.Point,i=function(n){function i(e,r){var a=n.call(this)||this;return a.containsAnimal=!1,a.isPopping=!1,a._pulseCount=0,a.name="Bubble "+t.generateId(),a.graphics.beginFill("rgba(255, 255, 255, .1)").beginStroke("rgba(255, 255, 255, .8)").setStrokeStyle(2).drawCircle(0,0,i.Radius),a.startPoint=e,a.x=a.startPoint.x,a.y=a.startPoint.y,a.endPoint=r,a}return __extends(i,n),i.prototype.move=function(){return this._tickListener=this.on("tick",this.handleTick,this),this.updateEndPoint(),r.get(this).to({x:this.endPoint.x,y:this.endPoint.y},t.getTweenDurationMSecs(this.startPoint,this.endPoint,i.Speed)).call(this.dispatchEvent.bind(this,new Event(i.EventAscended)))},i.prototype.takeAnimal=function(e){return this._animal=e,this.containsAnimal=!0,r.removeTweens(this._animal),this.x=this._animal.x,this.y=this._animal.y,this.scaleX=this.scaleY=1,this.startPoint=new a(this.x,this.y),this.endPoint=new a(this.x,-t.Animal.Radius),r.get(this,{override:!0}).to({x:this.endPoint.x,y:this.endPoint.y},t.getTweenDurationMSecs(this.startPoint,this.endPoint,i.AscendingSpeed)).call(this.dispatchEvent.bind(this,new Event(i.EventRescuedAnimal)))},i.prototype.getAnimal=function(){return this._animal},i.prototype.pop=function(){this.isPopping=!0,this.off("tick",this._tickListener),this.containsAnimal&&(this._animal.continueFall(),delete this._animal,this._animal=null,this.containsAnimal=!1),this.alpha=0,e.playSound(e.SoundAsset.BubblePop),this.dispatchEvent(new Event(i.EventPopped))},i.prototype.handleTick=function(){(this.x<0-i.Radius*this.scaleX||e.NormalWidth+i.Radius*this.scaleX<this.x)&&this.dispatchEvent(new Event(i.EventAscended)),this.containsAnimal&&(this._animal.x=this.x,this._animal.y=this.y),this.pulse()},i.prototype.pulse=function(){this.alpha=.4*Math.cos(.1*this._pulseCount++)+.85},i.prototype.updateEndPoint=function(){var t=0;this.endPoint.y>=this.startPoint.y&&(t=e.NormalHeight);var n=(this.startPoint.y-this.endPoint.y)/(this.startPoint.x-this.endPoint.x),r=this.endPoint.y-n*this.endPoint.x;this.endPoint.y=t,this.endPoint.x=(this.endPoint.y-r)/n},i.EventPopped="popped",i.EventAscended="ascended",i.EventRescuedAnimal="rescued",i.Radius=46,i.Speed=450,i.AscendingSpeed=150,i}(n);t.Bubble=i}(e.Game||(e.Game={}))}(BubbleGunner||(BubbleGunner={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),BubbleGunner;!function(e){!function(t){var n=createjs.Tween,r=createjs.Sprite,a=createjs.SpriteSheet,i=function(r){function i(e){var t=r.call(this,i.getSpriteSheet())||this;return t._startPoint=e,t.regX=t.regY=i.Radius,t.x=e.x,t.y=e.y,t}return __extends(i,r),i.prototype.flyTo=function(e){var r=n.get(this).to({x:e.x,y:e.y},t.getTweenDurationMSecs(this._startPoint,e,i.Speed));return this.gotoAndPlay("fly"),r},i.getSpriteSheet=function(){return 0===i.SpriteSheetData.images.length&&(i.SpriteSheetData.images[0]=e.loader.getResult("game-pterodactyl")),new a(i.SpriteSheetData)},i.Radius=87.5,i.Speed=250,i.SpriteSheetData={images:[],frames:[[0,176,175,175],[0,528,175,175],[176,0,175,175],[176,176,175,175],[0,352,175,175],[176,352,175,175],[352,0,175,175],[352,176,175,175],[352,352,175,175],[0,0,175,175],[176,528,175,175],[352,528,175,175],[528,0,175,175],[528,176,175,175],[528,352,175,175],[528,528,175,175],[0,704,175,175],[176,704,175,175]],framerate:18,animations:{fly:[0,17]}},i}(r);t.Pterodactyl=i}(e.Game||(e.Game={}))}(BubbleGunner||(BubbleGunner={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),BubbleGunner;!function(e){!function(t){var n=createjs.Shape,r=createjs.Tween,a=createjs.Text,i=createjs.Bitmap,o=createjs.Point,s=function(s){function c(){var r=s.call(this)||this;r._levelManager=new t.LevelManager,r._animals=[],r._bubbles=[],r._lavaPieces=[],r._isShapesLockFree=!0,r._gc=new e.GarbageCollector(r);var a=new n;a.graphics.beginFill("#222").drawRect(0,0,e.NormalWidth,e.NormalHeight),a.x=a.y=0,r.addChild(a);var o=new i(e.loader.getResult("volcano"));return r.addChild(o),r._scoresBar=new t.ScoresBar(r._levelManager),r._scoresBar.x=10,r._scoresBar.y=10,r._gc.registerEventListener(r._scoresBar,t.ScoresBar.EventNoLifeLeft,r.changeGameScene.bind(r,e.SceneType.GameOver)),r.addChild(r._scoresBar),r.setChildIndex(r._scoresBar,3),r._dragon=new t.Dragon,r._dragon.scaleX=r._dragon.scaleY=.3,r._dragon.x=e.NormalWidth/2,r._dragon.y=e.NormalHeight-r._dragon.originalHeight*r._dragon.scaleY-40,r.addChild(r._dragon),r.setChildIndex(r._dragon,3),r._pauseButton=new i(e.loader.getResult("pause")),r._pauseButton.x=30,r._pauseButton.y=e.NormalHeight-r._pauseButton.getBounds().height-30,r._pauseButton.cursor="pointer",r._gc.registerEventListener(r._pauseButton,"click",function(){e.playSound(e.SoundAsset.ButtonClick),r.changeGameScene(e.SceneType.Menu)}),r.addChild(r._pauseButton),r.setChildIndex(r._pauseButton,3),r._gc.registerEventListener(r,"tick",r.handleTick),r}return __extends(c,s),c.prototype.start=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this.alpha=-1,this.scaleX=this.scaleY=10,r.get(this).to({scaleX:1,scaleY:1,alpha:1},1e3),this._gc.registerEventListener(this.stage,"stagemousemove",this._dragon.aimGun,this._dragon),this._gc.registerEventListener(this.stage,"stagemouseup",this.handleClick),this._gc.registerEventListener(this._levelManager,t.LevelManager.EventLevelChanged,this.showLevelChangedDemo),this.playBackgroundMusic(),this.startRain()},c.prototype.startRain=function(){this._animalRainInterval=this._gc.registerInterval(this.handleAnimalRainInterval.bind(this),2300),this._lavaRainInterval=this._gc.registerInterval(this.handleLavaRainInterval.bind(this),3500)},c.prototype.stopRain=function(){this._gc.disposeInterval(this._animalRainInterval),this._gc.disposeInterval(this._lavaRainInterval)},c.prototype.changeGameScene=function(t){switch(this._bgMusic.stop(),this.removeAllChildren(),this._gc.disposeAll(),this._bubbles=this._animals=this._lavaPieces=[],t){case e.SceneType.Menu:this.dispatchEvent(new e.SceneEvent(e.SceneBase.EventChangeScene,e.SceneType.Menu));break;case e.SceneType.GameOver:this.dispatchEvent(new e.SceneEvent(e.SceneBase.EventChangeScene,e.SceneType.GameOver,this._scoresBar.getScore()));break;default:throw new Error("Invalid scene type: "+t)}},c.prototype.handleAnimalRainInterval=function(){var n=this,r=new t.Animal(new o(c.getRandomX(),0));this.lockShapes(function(){n._animals.push(r)}),this.addChild(r),this.setChildIndex(r,2),console.debug(this._animals),this._gc.registerEventListener(r,t.Animal.EventFell,this.handleAnimalFall),r.moveTo(new o(c.getRandomX(),e.NormalHeight))},c.prototype.handleLavaRainInterval=function(){var n=this,r=function(){var r=new t.LavaPiece(c.getRandomX());n.lockShapes(function(){return n._lavaPieces.push(r)}),n.addChild(r),n.setChildIndex(r,2),console.debug(n._lavaPieces),n._gc.registerEventListener(r,t.LavaPiece.EventFell,function(){return n.removeShape(r)}),r.moveTo(new o(c.getRandomX(),e.NormalHeight+t.LavaPiece.Radius)),e.playSound(e.SoundAsset.LavaPieceFall)};switch(this._levelManager.currentLevel){case 1:break;case 2:r();break;case 3:r();var a=1e3+Math.floor(3983475*Math.random())%1700;this._gc.registerTimeout(r.bind(this),a);break;default:throw"Invalid level: "+this._levelManager.currentLevel}},c.prototype.handleClick=function(n){var r=this;if(this._dragon.isReadyToShoot()){var a=this._pauseButton.globalToLocal(this.stage.mouseX,this.stage.mouseY);if(!this._pauseButton.hitTest(a.x,a.y)){var i=new o(n.stageX/this.stage.scaleX,n.stageY/this.stage.scaleY),s=this._dragon.shootBubbleTo(i);this.lockShapes(function(){r._bubbles.push(s)}),this.addChild(s),this.setChildIndex(s,2),console.debug(this._bubbles),this._gc.registerEventListener(s,t.Bubble.EventPopped,function(){return r.removeShape(s)}),this._gc.registerEventListener(s,t.Bubble.EventAscended,function(){return r.removeShape(s)}),this._gc.registerEventListener(s,t.Bubble.EventRescuedAnimal,function(){r._scoresBar.increaseScore(),r.removeShape(s.getAnimal(),s)}),e.playSound(e.SoundAsset.BubbleShoot),s.move()}}},c.prototype.playBackgroundMusic=function(){this._bgMusic=e.playSound(e.SoundAsset.GameBgMusic),this._bgMusic.loop=-1,this._bgMusic.volume=.5,this._bgMusic.pan=.5},c.prototype.handleAnimalFall=function(e){var t=e.target;this._scoresBar.decreaseRemainingLives(),this.removeShape(t)},c.prototype.showLevelChangedDemo=function(){var t=this;this.stopRain();var n;n=this._gc.registerInterval(function(){0===t._animals.length&&(t._gc.disposeInterval(n),t._levelText=new a("Level "+t._levelManager.currentLevel,"bold 24px Permanent Marker","yellow"),t._levelText.regX=t._levelText.getMeasuredWidth()/2,t._levelText.regY=t._levelText.getMeasuredHeight()/2,t._levelText.x=e.NormalWidth/2,t._levelText.y=e.NormalHeight/2,r.get(t._levelText).to({scaleX:5,scaleY:5,alpha:0},2500).call(function(){t.removeChild(t._levelText),t.startRain()}),t.addChild(t._levelText),e.playSound(e.SoundAsset.Volcano))},200)},c.prototype.removeShape=function(){for(var e=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];n=n.filter(function(e){return void 0!=e}),this.lockShapes(function(){for(var r=0,a=n;r<a.length;r++)!function(n){e.removeChild(n),n instanceof t.Bubble?(e._bubbles=e._bubbles.filter(function(e){return e!==n&&void 0!=e}),console.debug(e._bubbles)):n instanceof t.Animal?(e._animals=e._animals.filter(function(e){return e!==n&&void 0!=e}),console.debug(e._animals)):n instanceof t.LavaPiece?(e._lavaPieces=e._lavaPieces.filter(function(e){return e!==n&&void 0!=e}),console.debug(e._lavaPieces)):console.warn("Unknown type to remove: "+n)}(a[r])})},c.prototype.handleTick=function(){var e=this;this._isShapesLockFree&&this.lockShapes(function(){e._bubbles.filter(function(e){return!e.isPopping}).filter(e.isCollidingWithAnyLavaPiece(e._lavaPieces)).forEach(e.popBubble.bind(e)),e._bubbles.filter(e.isNotCollidingWithOtherBubbles(e._bubbles)).map(function(t){return[t,e.findClosestAnimalCollidingWithBubble(t,e._animals)]}).filter(e.tupleHasValues).forEach(function(e){return e[0].takeAnimal(e[1])})})},c.getRandomX=function(){return 324627938*Math.random()%e.NormalWidth},c.prototype.lockShapes=function(e){this._isShapesLockFree=!1,e(),this._isShapesLockFree=!0},c.prototype.isCollidingWithAnyLavaPiece=function(e){var n=t.Bubble.Radius+t.LavaPiece.Radius;return function(r){return e.some(function(e){return t.getObjectsDistance(r,e)<=n})}},c.prototype.popBubble=function(e){e.containsAnimal||this._dragon.setGunFireDelay(1500),e.pop()},c.prototype.isNotCollidingWithOtherBubbles=function(e){var n=2*t.Bubble.Radius;return function(r){var a=new o(r.x,r.y);return 0===e.filter(function(e){return e!==r}).filter(function(e){var r=new o(e.x,e.y);return t.getPointsDistance(a,r)<=n}).length}},c.prototype.findClosestAnimalCollidingWithBubble=function(e,n){var r=t.Bubble.Radius+t.Animal.Radius;return n.map(function(n){return[n,t.getObjectsDistance(e,n)]}).filter(function(e){return e[1]<r}).sort(function(e,t){return e[1]<t[1]?-1:e[1]===t[1]?0:1}).map(function(e){return e[0]}).shift()},c.prototype.tupleHasValues=function(e){return e.every(function(e){return void 0!=e})},c}(e.SceneBase);t.GameScene=s}(e.Game||(e.Game={}))}(BubbleGunner||(BubbleGunner={}));var Telegram;!function(e){!function(e){!function(e){var t=function(){return function(){}}();e.User=t}(e.Framework||(e.Framework={}))}(e.Bot||(e.Bot={}))}(Telegram||(Telegram={}));var Telegram;!function(e){!function(e){!function(e){var t=function(){return function(){}}();e.GameHighScore=t}(e.Framework||(e.Framework={}))}(e.Bot||(e.Bot={}))}(Telegram||(Telegram={}));var Telegram;!function(e){!function(e){!function(e){var t=function(){return function(e,t){this.playerId=e,this.score=t}}();e.ScoreData=t}(e.Framework||(e.Framework={}))}(e.Bot||(e.Bot={}))}(Telegram||(Telegram={}));var Telegram;!function(e){!function(e){!function(e){function t(){return r(location.href,"id")}function n(){return r(location.href,"gameScoreUrl")}function r(e,t){for(var n=null,r=0,a=e.substr(e.indexOf("#")+1).split("&");r<a.length;r++){var i=a[r];i.match("^"+t+"=.+$")&&(n=i.substr(t.length+1),n=decodeURIComponent(n))}return n}e.gameScoreUrlExists=function(){var e=n();return void 0!=e&&e.length>1},e.sendUserScore=function(r){var a=n(),i=t(),o=new e.ScoreData(i,r);console.debug('Sending score to "'+a+'"',o);var s=new XMLHttpRequest;s.open("POST",a),s.onreadystatechange=function(e){return console.debug(e)},s.send(JSON.stringify(o))}}(e.Framework||(e.Framework={}))}(e.Bot||(e.Bot={}))}(Telegram||(Telegram={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),BubbleGunner;!function(e){!function(t){var n=createjs.Bitmap,r=createjs.Tween,a=createjs.Text,i=function(t){function i(){var r=t.call(this)||this;r._pulseCount=0;var i=new a("GAME OVER","80px Permanent Marker","#F57"),o=i.getBounds();return i.x=e.NormalWidth/2-o.width/2,i.y=30,r.addChild(i),r._refreshButton=new n(e.loader.getResult("refresh")),r._refreshButton.regX=r._refreshButton.getBounds().width/2,r._refreshButton.regY=r._refreshButton.getBounds().height/2,r._refreshButton.x=e.NormalWidth/2,r._refreshButton.y=e.NormalHeight/2,r._refreshButton.on("click",r.dispatchPlayGameEvent,r),r._refreshButton.cursor="pointer",r.addChild(r._refreshButton),r}return __extends(i,t),i.prototype.start=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(this._pulseIntervalHandle=setInterval(this.pulse.bind(this),60),1===e.length&&Telegram.Bot.Framework.gameScoreUrlExists()){var n=e[0][0][0];Telegram.Bot.Framework.sendUserScore(n)}},i.prototype.dispatchPlayGameEvent=function(){e.playSound(e.SoundAsset.ButtonClick),clearInterval(this._pulseIntervalHandle),this.dispatchEvent(new e.SceneEvent(e.SceneBase.EventChangeScene,e.SceneType.Game))},i.prototype.pulse=function(){var e=.4*Math.cos(.1*this._pulseCount++)+2;r.get(this._refreshButton).to({scaleX:e,scaleY:e,rotation:5*-this._pulseCount},30),this._pulseCount++},i}(e.SceneBase);t.GameOverScene=i}(e.GameOver||(e.GameOver={}))}(BubbleGunner||(BubbleGunner={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),BubbleGunner;!function(e){var t=createjs.Ticker,n=createjs.Touch,r=createjs.EventDispatcher,a=e.Menu.MenuScene,i=e.Game.GameScene,o=e.Menu.PreloadScene,s=e.Help.HelpScene,c=e.GameOver.GameOverScene,u=function(r){function u(e){var t=r.call(this)||this;return t._stage=e,t}return __extends(u,r),u.prototype.startGame=function(){t.framerate=60,t.addEventListener("tick",this._stage),n.enable(this._stage),this._stage.enableMouseOver(10),this.startNewScene(e.SceneType.Preload)},u.prototype.startNewScene=function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];this._stage.removeAllChildren(),this._currentScene=u.createScene(t),this._stage.addChild(this._currentScene),this._currentScene.on(e.SceneBase.EventChangeScene,this.changeSceneHandler,this),this._currentScene.start(n)},u.prototype.changeSceneHandler=function(e){this.startNewScene(e.toScene,e.startArgs)},u.createScene=function(t){var n;switch(t){case e.SceneType.Preload:n=new o;break;case e.SceneType.Menu:n=new a;break;case e.SceneType.Help:n=new s;break;case e.SceneType.Game:n=new i;break;case e.SceneType.GameOver:n=new c;break;default:throw new Error("Scene type "+t+" not implemented yet")}return n},u}(r);e.GameManager=u}(BubbleGunner||(BubbleGunner={})),window.addEventListener("load",init);