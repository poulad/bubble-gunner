function resizeCanvas(e,t){window.innerHeight<=window.innerWidth?e.height=e.width=window.innerHeight:e.height=e.width=window.innerWidth,e.width>1200&&(e.height=e.width=1200);var n=e.width/BubbleGunner.NormalWidth;t.scaleX=t.scaleY=n;var a=(window.innerHeight-e.height)/2;e.style.marginTop=a+"px"}function init(){BubbleGunner.canvas=document.getElementById("canvas");var e=new createjs.Stage(BubbleGunner.canvas);window.addEventListener("resize",resizeCanvas.bind(this,BubbleGunner.canvas,e),!1),resizeCanvas(BubbleGunner.canvas,e),new BubbleGunner.GameManager(e).startGame()}var BubbleGunner;!function(e){e.NormalWidth=800,e.NormalHeight=800}(BubbleGunner||(BubbleGunner={}));var BubbleGunner;!function(e){!function(e){e[e.Preload=0]="Preload",e[e.Menu=1]="Menu",e[e.Help=2]="Help",e[e.Game=3]="Game",e[e.GameOver=4]="GameOver"}(e.SceneType||(e.SceneType={}))}(BubbleGunner||(BubbleGunner={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),BubbleGunner;!function(e){var t=function(e){function t(t,n){for(var a=[],r=2;r<arguments.length;r++)a[r-2]=arguments[r];var i=e.call(this,t,void 0,void 0)||this;return i.toScene=n,i.startArgs=a,i}return __extends(t,e),t}(createjs.Event);e.SceneEvent=t}(BubbleGunner||(BubbleGunner={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),BubbleGunner;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.EventChangeScene="changeScene",t}(createjs.Container);e.SceneBase=t}(BubbleGunner||(BubbleGunner={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),BubbleGunner;!function(e){!function(t){var n=createjs.Shape,a=createjs.Text,r=createjs.Tween,i=createjs.LoadQueue,o=createjs.Sound,s=function(t){function s(){var r=t.call(this)||this;return r._circle=new n,r._circle.graphics.setStrokeStyle(5).beginStroke("rgba(200, 200, 200, .4)").beginFill("lightblue").drawCircle(0,0,s.Radius),r._circle.x=e.NormalWidth/2,r._circle.y=e.NormalHeight/2,r._text=new a("0 %","40px Permanent Marker","#444"),r._text.x=r._text.y=-100,r.addChild(r._circle,r._text),r}return __extends(s,t),s.prototype.start=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.loader=new i(!0,"assets/"),e.loader.installPlugin(createjs.Sound),o.alternateExtensions=["mp3"],e.loader.on("progress",this.updateProgress,this),e.loader.on("complete",this.changeToMenuScene,this),e.loader.loadManifest([{id:"sound-button",src:"sounds/button.ogg"},{id:"dragon",src:"images/dragon.png"},{id:"dragon-hand",src:"images/dragon-hand.png"},{id:"volcano",src:"images/volcano.png"},{id:"heart",src:"images/heart.png"},{id:"menu-volcano",src:"images/volcano-menu.png"},{id:"menu-dragon",src:"images/dragon-menu.png"},{id:"menu-start",src:"images/start.png"},{id:"menu-help",src:"images/help.png"},{id:"help-guide",src:"images/help-guide.png"},{id:"back",src:"images/back.png"},{id:"pause",src:"images/pause.png"},{id:"refresh",src:"images/refresh.png"},{id:"scoresbar",src:"images/scoresbar.png"},{id:"game-lava",src:"images/lava.png"},{id:"game-animal0",src:"images/animal0.png"},{id:"game-animal1",src:"images/animal1.png"},{id:"game-animal2",src:"images/animal2.png"},{id:"game-animal3",src:"images/animal3.png"},{id:"s:game-bgm",src:"sounds/game-bgm.ogg"},{id:"s:game-bubble-shoot",src:"sounds/bubble-shoot.ogg"},{id:"game-lava-fall",src:"sounds/lava-fall.ogg"}])},s.prototype.updateProgress=function(t){var n=Math.floor(100*t.loaded),a=(this._circle.scaleX+10*n)/100;r.get(this._circle).to({scaleX:a,scaleY:a},150);this._text.text=n+" %",this._text.x=e.NormalWidth/2-this._text.getMeasuredWidth()/2,this._text.y=e.NormalHeight/2-this._text.getMeasuredHeight()/2},s.prototype.changeToMenuScene=function(){var t=this;r.removeTweens(this._circle),r.get(this._circle).to({scaleX:10,scaleY:10},200).call(function(){return setTimeout(function(){return t.dispatchEvent(new e.SceneEvent(e.SceneBase.EventChangeScene,e.SceneType.Menu))},400)})},s.Radius=50,s}(e.SceneBase);t.PreloadScene=s}(e.Menu||(e.Menu={}))}(BubbleGunner||(BubbleGunner={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),BubbleGunner;!function(e){!function(t){var n=createjs.Shape,a=createjs.Bitmap,r=createjs.Graphics,i=createjs.Tween,o=createjs.Sound,s=createjs.SpriteSheet,c=createjs.Sprite,l=createjs.Container,u=function(t){function u(){var i=t.call(this)||this,o=(new r).beginFill("lightblue").drawRect(0,0,e.NormalWidth,e.NormalHeight);i.addChild(new n(o));var l=new a(e.loader.getResult("menu-volcano"));i.addChild(l),i._btnStartGame=new a(e.loader.getResult("menu-start")),i._btnStartGame.regX=i._btnStartGame.image.width/2,i._btnStartGame.regY=i._btnStartGame.image.height/2,i._btnStartGame.x=e.NormalWidth/2,i._btnStartGame.y=e.NormalHeight/2,i._btnStartGame.cursor="pointer",i._btnStartGame.on("click",i.onStartButtonClick,i),i.addChild(i._btnStartGame),setInterval(i.pulse.bind(i),120),i._btnHelp=new a(e.loader.getResult("menu-help")),i._btnHelp.x=e.NormalWidth-i._btnHelp.image.width-50,i._btnHelp.y=50,i._btnHelp.cursor="pointer",i._btnHelp.on("click",i.onHelpButtonClick,i),i.addChild(i._btnHelp);var u={images:[e.loader.getResult("menu-dragon")],frames:[[0,0,552,674],[552,0,552,674],[0,0,552,674],[0,674,552,674],[552,674,552,674]],framerate:4,animations:{cheer:[0,2,"run"],runCheer:[3,4,"cheer"],run:[3,4]}};i._dragon=new c(new s(u)),i._dragon.regX=226,i._dragon.regY=337;return i._dragon.x=6*e.NormalWidth/9,i._dragon.y=e.NormalHeight-190,i._dragon.scaleX=i._dragon.scaleY=.4,i.addChild(i._dragon),i}return __extends(u,t),u.prototype.start=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._dragon.on("animationend",this.moveDragon,this),this._dragon.gotoAndPlay("run"),this.moveDragon(void 0)},u.prototype.onStartButtonClick=function(){var t=this;o.play("sound-button"),i.get(this).to({alpha:0,scaleX:10,scaleY:10},2e3).call(function(){t.dispatchEvent(new e.SceneEvent(e.SceneBase.EventChangeScene,e.SceneType.Game))})},u.prototype.onHelpButtonClick=function(){o.play("sound-button"),this.dispatchEvent(new e.SceneEvent(e.SceneBase.EventChangeScene,e.SceneType.Help))},u.prototype.moveDragon=function(t){var n=this;if(!t||"cheer"===t.name){console.debug("Dragon running to other side");var a=this._dragon.scaleX>0?3*e.NormalWidth/9:6*e.NormalWidth/9;i.get(this._dragon).to({x:a},2500).call(function(){n._dragon.gotoAndPlay("cheer"),n._dragon.scaleX*=-1})}},u.prototype.pulse=function(){var e=this._btnStartGame.scaleX+.05;e>=1.2&&(e=1),i.get(this._btnStartGame).to({scaleX:e,scaleY:e},110);var t=this._btnHelp.alpha-.08;t<.9&&(t=1),i.get(this._btnHelp).to({alpha:t},110)},u.prototype.createStartGameButton=function(){this._btnStartGame2=new l;var t=new n;t.graphics.beginFill("orange").beginStroke("#A88").setStrokeStyle(6).drawRoundRect(0,0,200,100,10),this._btnStartGame2.addChild(t),this._btnStartGame2.regX=100,this._btnStartGame2.regY=50,this._btnStartGame2.x=e.NormalWidth/2,this._btnStartGame2.y=e.NormalHeight/2,this._btnStartGame2.cursor="pointer",this._btnStartGame2.on("click",this.onStartButtonClick,this),this.addChild(this._btnStartGame2)},u}(e.SceneBase);t.MenuScene=u}(e.Menu||(e.Menu={}))}(BubbleGunner||(BubbleGunner={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),BubbleGunner;!function(e){!function(t){var n=createjs.Bitmap,a=createjs.Sound,r=createjs.Shape,i=function(t){function i(){var a=t.call(this)||this,i=new r;i.graphics.beginFill("lightblue").drawRect(0,0,e.NormalWidth,e.NormalHeight),a.addChild(i);var o=new n(e.loader.getResult("back"));o.x=30,o.y=30,o.on("click",a.dispatchBackToMenuEvent,a),o.cursor="pointer",o.scaleX=o.scaleY=1.5,a.addChild(o);var s=new n(e.loader.getResult("help-guide"));return s.scaleX=s.scaleY=.8,s.x=130,s.y=120,a.addChild(s),a}return __extends(i,t),i.prototype.start=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},i.prototype.dispatchBackToMenuEvent=function(){a.play("sound-button"),this.dispatchEvent(new e.SceneEvent(e.SceneBase.EventChangeScene,e.SceneType.Menu))},i}(e.SceneBase);t.HelpScene=i}(e.Help||(e.Help={}))}(BubbleGunner||(BubbleGunner={}));var BubbleGunner;!function(e){!function(e){function t(e,t){return Math.sqrt(Math.pow(e.y-t.y,2)+Math.pow(e.x-t.x,2))}var n=createjs.Point,a=0;e.hasCollisions=function(e){return e[1].length>0},e.getPointsDistance=t,e.getObjectsDistance=function(e,a){return t(new n(e.x,e.y),new n(e.y,a.y))},e.getTweenDurationMSecs=function(e,n,a){return Math.floor(1e3*t(e,n)/a)},e.generateId=function(){return++a}}(e.Game||(e.Game={}))}(BubbleGunner||(BubbleGunner={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),BubbleGunner;!function(e){!function(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.currentLevel=1,t}return __extends(t,e),t.prototype.getLevelMaxScore=function(e){return void 0==e&&(e=this.currentLevel),t.Level1MaxScore*e},t.prototype.setScore=function(e){this.currentLevel<3&&e>this.getLevelMaxScore()&&(this.currentLevel++,this.dispatchEvent(new Event(t.EventLevelChanged)))},t.EventLevelChanged="levelChanged",t.Level1MaxScore=4,t}(createjs.EventDispatcher);e.LevelManager=t}(e.Game||(e.Game={}))}(BubbleGunner||(BubbleGunner={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),BubbleGunner;!function(e){!function(t){var n=createjs.Shape,a=createjs.Tween,r=createjs.Container,i=createjs.Text,o=createjs.Bitmap,s=function(r){function s(a,s,c){void 0===s&&(s=0),void 0===c&&(c=4);var l=r.call(this)||this;l._levelManager=a,l._score=s,l._remainingLives=c,l._hearts=[],l.name="Scores bar "+t.generateId();l._mask=new o(e.loader.getResult("scoresbar")),l.addChild(l._mask),l.setChildIndex(l._mask,2),l._bar=new n,l._bar.graphics.beginFill("yellow").drawRect(0,0,.72,l._mask.getBounds().height-6),l._bar.scaleX=0,l._bar.x=3,l._bar.y=3,l.addChild(l._bar),l.setChildIndex(l._bar,1),l._scoreText=new i(l._score.toString(),"20px Permanent Marker","white"),l._scoreText.x=l._mask.getBounds().width+10,l.addChild(l._scoreText),l.setChildIndex(l._scoreText,1);for(var u=0;u<c;u++){var h=new o(e.loader.getResult("heart"));h.scaleX=h.scaleY=.3,h.x=20*u,h.y=l._mask.getBounds().height+8,l._hearts.push(h),l.addChild(h)}return l}return __extends(s,r),s.prototype.increaseScore=function(){this.setScore(this._score+1)},s.prototype.decreaseRemainingLives=function(){this.setRemainingLives(this._remainingLives-1)},s.prototype.setScore=function(e){this._score=e,this._levelManager.setScore(this._score);var t=this._score/this._levelManager.getLevelMaxScore()*100;t=t>=100?100:t,a.get(this._bar).to({scaleX:t},300),this._scoreText.text=this._score.toString()},s.prototype.getScore=function(){return this._score},s.prototype.setRemainingLives=function(e){var t=this;this._remainingLives=e,this._hearts.filter(function(t,n){return n+1>e}).forEach(function(e){a.get(e).to({alpha:0,x:-50},300).call(function(){t.removeChild(e),t._hearts.pop(),console.debug("Hearts left: "+t._hearts.length),t._hearts.length<=0&&t.dispatchEvent(new Event(s.EventNoLifeLeft))})})},s.prototype.getRemainingLives=function(){return this._remainingLives},s.EventNoLifeLeft="noLifeLeft",s}(r);t.ScoresBar=s}(e.Game||(e.Game={}))}(BubbleGunner||(BubbleGunner={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),BubbleGunner;!function(e){!function(t){var n=createjs.Tween,a=createjs.Container,r=createjs.Bitmap,i=createjs.Ease,o=createjs.Point,s=function(a){function s(){var n=a.call(this)||this;return n.originalWidth=140,n.originalHeight=408,n._canShoot=!0,n.name="Dragon "+t.generateId(),n._body=new r(e.loader.getResult("dragon")),n._hand=new r(e.loader.getResult("dragon-hand")),n._hand.regX=426,n._hand.regY=110,n._hand.x=250,n._hand.y=180,n.addChild(n._body,n._hand),n}return __extends(s,a),s.prototype.shootBubbleTo=function(e){if(this._canShoot){this.aimGunToPoint(e);var a=this.getGunMuzzleStagePoint(),r=new t.Bubble(a,e);console.debug("Shooting bubble from: "+a);var o=r.scaleX;return r.scaleX=r.scaleY=.1,n.get(r).to({scaleX:o,scaleY:o},150,i.bounceOut),this.setGunFireDelay(s.FireRate),r}},s.prototype.setGunFireDelay=function(e){var t=this;clearTimeout(this._gunFireTimeoutHandle),this._canShoot=!1,this._gunFireTimeoutHandle=setTimeout(function(){void 0!=t&&(t._canShoot=!0)},e)},s.prototype.aimGun=function(e){var t=e.target,n=new o(e.stageX/t.scaleX,e.stageY/t.scaleY);this.aimGunToPoint(n)},s.prototype.isReadyToShoot=function(){return this._canShoot},s.prototype.aimGunToPoint=function(e){var t=this.getHandRegStagePoint();t.x<e.x?this.scaleX=-Math.abs(this.scaleX):this.scaleX=Math.abs(this.scaleX),t=this.getHandRegStagePoint();var n=e.y-t.y,a=e.x-t.x,r=Math.atan(n/a)/Math.PI*180;this.scaleX<0&&(r*=-1),r<-10&&(r=-10),this._hand.rotation=r},s.prototype.getHandRegStagePoint=function(){return new o(this.x+this._hand.x*this.scaleX,this.y+this._hand.y*this.scaleY)},s.prototype.getGunMuzzleStagePoint=function(){var e=new o,t=Math.PI+this._hand.rotation*Math.PI/180;this.scaleX<0&&(t=2*Math.PI-t);var n=426*this.scaleX,a=this.getHandRegStagePoint();return e.x=a.x+n*Math.cos(t),e.y=a.y+n*Math.sin(t),e},s.FireRate=650,s}(a);t.Dragon=s}(e.Game||(e.Game={}))}(BubbleGunner||(BubbleGunner={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),BubbleGunner;!function(e){!function(t){var n=createjs.Tween,a=createjs.Bitmap,r=createjs.Point,i=function(a){function i(n){var o=a.call(this,e.loader.getResult("game-lava"))||this;return o.name="Lava piece "+t.generateId(),o.startPoint=new r(n,2*-i.Radius),o.regX=o.regY=i.Radius,o.scaleX=o.scaleY=1,o.x=o.startPoint.x,o.y=o.startPoint.y,o}return __extends(i,a),i.prototype.moveTo=function(e){var a=this;return this.endPoint=e,n.get(this).to({x:this.endPoint.x,y:this.endPoint.y,rotation:180},t.getTweenDurationMSecs(this.startPoint,this.endPoint,i.Speed)).call(function(){return a.dispatchEvent(new Event(i.EventFell))})},i.EventFell="fell",i.Radius=30,i.Speed=400,i}(a);t.LavaPiece=i}(e.Game||(e.Game={}))}(BubbleGunner||(BubbleGunner={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),BubbleGunner;!function(e){!function(t){var n=createjs.Tween,a=createjs.Bitmap,r=createjs.Point,i=function(a){function i(e){var n=a.call(this,i.getRandomAnimalImage())||this;return n.name="Animal "+t.generateId(),n.regX=n.regY=i.Radius,n.x=e.x,n.y=e.y,n.startPoint=e,n}return __extends(i,a),i.prototype.moveTo=function(e){return this.endPoint=e,n.get(this).to({x:this.endPoint.x,y:this.endPoint.y},t.getTweenDurationMSecs(this.startPoint,this.endPoint,i.Speed)).call(this.fallCallback.bind(this))},i.prototype.continueFall=function(){n.removeTweens(this);var t=new r(this.endPoint.x,e.NormalHeight);return this.moveTo(t)},i.prototype.fallCallback=function(){return n.get(this).to({alpha:.3},300).call(this.dispatchEvent.bind(this,i.EventFell))},i.getRandomAnimalImage=function(){var t=Math.floor(34234*Math.random())%4;return e.loader.getResult("game-animal"+t)},i.EventFell="fell",i.Radius=40,i.Speed=330,i}(a);t.Animal=i}(e.Game||(e.Game={}))}(BubbleGunner||(BubbleGunner={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),BubbleGunner;!function(e){!function(t){var n=createjs.Shape,a=createjs.Tween,r=createjs.Point,i=function(n){function i(e,a){var r=n.call(this)||this;return r.containsAnimal=!1,r._pulseCount=0,r.name="Bubble "+t.generateId(),r.graphics.beginFill("rgba(255, 255, 255, .1)").beginStroke("rgba(255, 255, 255, .8)").setStrokeStyle(2).drawCircle(0,0,i.Radius),r.startPoint=e,r.x=r.startPoint.x,r.y=r.startPoint.y,r.endPoint=a,r}return __extends(i,n),i.prototype.move=function(){return this.on("tick",this.handleTick,this),this.updateEndPoint(),a.get(this).to({x:this.endPoint.x,y:this.endPoint.y},t.getTweenDurationMSecs(this.startPoint,this.endPoint,i.Speed)).call(this.dispatchEvent.bind(this,new Event(i.EventAscended)))},i.prototype.takeAnimal=function(e){return this._animal=e,this.containsAnimal=!0,this.x=this._animal.x,this.y=this._animal.y,a.removeTweens(this),a.removeTweens(this._animal),this.scaleX=this.scaleY=1,this.startPoint=new r(this.x,this.y),this.endPoint=new r(this.x,-t.Animal.Radius),a.get(this).to({x:this.endPoint.x,y:this.endPoint.y},t.getTweenDurationMSecs(this.startPoint,this.endPoint,i.AscendingSpeed)).call(this.dispatchEvent.bind(this,new Event(i.EventRescuedAnimal)))},i.prototype.getAnimal=function(){return this._animal},i.prototype.pop=function(){return a.removeTweens(this),this.containsAnimal&&this._animal.continueFall(),a.get(this).to({alpha:0}).call(this.dispatchEvent.bind(this,new Event(i.EventPopped)))},i.prototype.handleTick=function(){(this.x<0-i.Radius*this.scaleX||e.NormalWidth+i.Radius*this.scaleX<this.x)&&this.dispatchEvent(new Event(i.EventAscended)),this.containsAnimal&&(this._animal.y=this.y),this.pulse()},i.prototype.pulse=function(){var e=.4*Math.cos(.1*this._pulseCount++)+.6;a.get(this).to({alpha:e}),this._pulseCount++},i.prototype.updateEndPoint=function(){var t=0;this.endPoint.y>=this.startPoint.y&&(t=e.NormalHeight);var n=(this.startPoint.y-this.endPoint.y)/(this.startPoint.x-this.endPoint.x),a=this.endPoint.y-n*this.endPoint.x;this.endPoint.y=t,this.endPoint.x=(this.endPoint.y-a)/n},i.EventPopped="popped",i.EventAscended="ascended",i.EventRescuedAnimal="rescued",i.Radius=46,i.Speed=450,i.AscendingSpeed=100,i}(n);t.Bubble=i}(e.Game||(e.Game={}))}(BubbleGunner||(BubbleGunner={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),BubbleGunner;!function(e){!function(t){var n=createjs.Shape,a=createjs.Tween,r=createjs.Text,i=createjs.Bitmap,o=createjs.Sound,s=createjs.Point,c=function(c){function l(){var a=c.call(this)||this;a._levelManager=new t.LevelManager,a._animals=[],a._bubbles=[],a._lavaPieces=[],a._isShapesLockFree=!0;var r=new n;r.graphics.beginFill("#222").drawRect(0,0,e.NormalWidth,e.NormalHeight),r.x=r.y=0,a.addChild(r);var s=new i(e.loader.getResult("volcano"));return a.addChild(s),a._scoresBar=new t.ScoresBar(a._levelManager),a._scoresBar.x=10,a._scoresBar.y=10,a._scoresBarListener=a._scoresBar.on(t.ScoresBar.EventNoLifeLeft,a.changeGameScene.bind(a,e.SceneType.GameOver)),a.addChild(a._scoresBar),a.setChildIndex(a._scoresBar,3),a._dragon=new t.Dragon,a._dragon.scaleX=a._dragon.scaleY=.3,a._dragon.x=e.NormalWidth/2,a._dragon.y=e.NormalHeight-a._dragon.originalHeight*a._dragon.scaleY-40,a.addChild(a._dragon),a.setChildIndex(a._dragon,3),a._pauseButton=new i(e.loader.getResult("pause")),a._pauseButton.x=30,a._pauseButton.y=e.NormalHeight-a._pauseButton.getBounds().height-30,a._pauseButton.cursor="pointer",a._pauseButtonListener=a._pauseButton.on("click",function(){o.play("sound-button"),a.changeGameScene(e.SceneType.Menu)},a),a.addChild(a._pauseButton),a.setChildIndex(a._pauseButton,3),a._tickListener=a.on("tick",a.handleTick,a),a}return __extends(l,c),l.prototype.start=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this.alpha=-1,this.scaleX=this.scaleY=10,a.get(this).to({scaleX:1,scaleY:1,alpha:1},1e3),this._mouseMoveListener=this.stage.on("stagemousemove",this._dragon.aimGun,this._dragon),this._mouseUpListener=this.stage.on("stagemouseup",this.handleClick,this),this._levelListener=this._levelManager.on(t.LevelManager.EventLevelChanged,this.showLevelChangedDemo,this),this.playBackgroundMusic(),this.startRain()},l.prototype.startRain=function(){this._animalRainInterval=setInterval(this.handleAnimalRainInterval.bind(this),2300),this._lavaRainInterval=setInterval(this.handleLavaRainInterval.bind(this),3500)},l.prototype.stopRain=function(){clearInterval(this._animalRainInterval),clearInterval(this._lavaRainInterval)},l.prototype.changeGameScene=function(n){switch(this.off("tick",this._tickListener),this.stage.off("stagemousemove",this._mouseMoveListener),this.stage.off("stagemouseup",this._mouseUpListener),this._scoresBar.off(t.ScoresBar.EventNoLifeLeft,this._scoresBarListener),this._bgMusic.off("complete",this._bgMusicListener),this._pauseButton.off("click",this._pauseButtonListener),this._levelManager.off(t.LevelManager.EventLevelChanged,this._levelListener),this.stopRain(),this._bgMusic.stop(),this.removeAllChildren(),this._bubbles.length=this._animals.length=this._lavaPieces.length=0,n){case e.SceneType.Menu:this.dispatchEvent(new e.SceneEvent(e.SceneBase.EventChangeScene,e.SceneType.Menu));break;case e.SceneType.GameOver:this.dispatchEvent(new e.SceneEvent(e.SceneBase.EventChangeScene,e.SceneType.GameOver));break;default:throw new Error("Invalid scene type: "+n)}},l.prototype.handleAnimalRainInterval=function(){var n=this,a=new t.Animal(new s(l.getRandomX(),0));this.lockShapes(function(){n._animals.push(a)}),this.addChild(a),this.setChildIndex(a,2),console.debug(this._animals),a.on(t.Animal.EventFell,this.handleAnimalFall,this),a.moveTo(new s(l.getRandomX(),e.NormalHeight))},l.prototype.handleLavaRainInterval=function(){var n=this,a=function(){var a=new t.LavaPiece(l.getRandomX());n.lockShapes(function(){return n._lavaPieces.push(a)}),n.addChild(a),n.setChildIndex(a,2),console.debug(n._lavaPieces),a.on(t.LavaPiece.EventFell,function(){return n.removeShape(a)},n),a.moveTo(new s(l.getRandomX(),e.NormalHeight+t.LavaPiece.Radius)),o.play("game-lava-fall")};switch(this._levelManager.currentLevel){case 1:break;case 2:a();break;case 3:a(),setTimeout(a,1200);break;default:throw"Invalid level: "+this._levelManager.currentLevel}},l.prototype.handleClick=function(e){var n=this;if(this._dragon.isReadyToShoot()){var a=this._pauseButton.globalToLocal(this.stage.mouseX,this.stage.mouseY);if(!this._pauseButton.hitTest(a.x,a.y)){var r=new s(e.stageX/this.stage.scaleX,e.stageY/this.stage.scaleY),i=this._dragon.shootBubbleTo(r);this.lockShapes(function(){n._bubbles.push(i)}),this.addChild(i),this.setChildIndex(i,2),console.debug(this._bubbles),i.on(t.Bubble.EventPopped,function(){return n.removeShape(i)},this),i.on(t.Bubble.EventAscended,function(){return n.removeShape(i)},this),i.on(t.Bubble.EventRescuedAnimal,function(){n._scoresBar.increaseScore(),n.removeShape(i.getAnimal(),i)},this),o.play("s:game-bubble-shoot"),i.move()}}},l.prototype.playBackgroundMusic=function(){this._bgMusic=o.play("s:game-bgm"),this._bgMusicListener=this._bgMusic.on("complete",this.playBackgroundMusic,this),this._bgMusic.volume=.5,this._bgMusic.pan=.5},l.prototype.handleAnimalFall=function(e){var t=e.target;this._scoresBar.decreaseRemainingLives(),this.removeShape(t)},l.prototype.showLevelChangedDemo=function(){var t=this;this.stopRain();var n;n=setInterval(function(){0===t._animals.length&&(clearInterval(n),t._levelText=new r(void 0,"bold 24px Permanent Marker","yellow"),t._levelText.text="Level "+t._levelManager.currentLevel,t._levelText.regX=t._levelText.getMeasuredWidth()/2,t._levelText.regY=t._levelText.getMeasuredHeight()/2,t._levelText.x=e.NormalWidth/2,t._levelText.y=e.NormalHeight/2,a.get(t._levelText).to({scaleX:5,scaleY:5,alpha:0},2500).call(function(){t.removeChild(t._levelText),t.startRain()}),t.addChild(t._levelText))},200)},l.prototype.removeShape=function(){for(var e=this,n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];this.lockShapes(function(){for(var a=0,r=n;a<r.length;a++)!function(n){e.removeChild(n),n instanceof t.Bubble?(e._bubbles=e._bubbles.filter(function(e){return e!==n&&void 0!=e}),console.debug(e._bubbles)):n instanceof t.Animal?(e._animals=e._animals.filter(function(e){return e!==n&&void 0!=e}),console.debug(e._animals)):n instanceof t.LavaPiece?(e._lavaPieces=e._lavaPieces.filter(function(e){return e!==n&&void 0!=e}),console.debug(e._lavaPieces)):console.warn("Unknown type to remove: "+n)}(r[a])})},l.prototype.handleTick=function(){var e=this;this._isShapesLockFree&&this.lockShapes(function(){e._bubbles.filter(e.isCollidingWithAnyLava(e._lavaPieces)).forEach(function(t){console.debug("lava is popping "+t.name),t.containsAnimal||e._dragon.setGunFireDelay(1500),t.pop()}),e._bubbles.filter(e.isNotCollidingWithOtherBubbles(e._bubbles)).map(function(t){return[t,e.findAnimalsCollidingWithBubble(t,e._animals)]}).filter(t.hasCollisions).map(function(e){return[e[0],e[1][0]]}).forEach(function(e){return e[0].takeAnimal(e[1])})})},l.getRandomX=function(){return 324627938*Math.random()%e.NormalWidth},l.prototype.lockShapes=function(e){this._isShapesLockFree=!1,e(),this._isShapesLockFree=!0},l.prototype.isNotCollidingWithOtherBubbles=function(e){var n=2*t.Bubble.Radius;return function(a){var r=new s(a.x,a.y);return 0===e.filter(function(e){return e!==a}).filter(function(e){var a=new s(e.x,e.y);return t.getPointsDistance(r,a)<=n}).length}},l.prototype.findAnimalsCollidingWithBubble=function(e,n){var a=t.Bubble.Radius+t.Animal.Radius,r=new s(e.x,e.y);return n.filter(function(e){var n=new s(e.x,e.y);return t.getPointsDistance(r,n)<=a})},l.prototype.isCollidingWithAnyLava=function(e){return function(n){return e.some(function(e){return t.getObjectsDistance(n,e)<=t.Bubble.Radius*n.scaleX+t.LavaPiece.Radius*e.scaleX})}},l}(e.SceneBase);t.GameScene=c}(e.Game||(e.Game={}))}(BubbleGunner||(BubbleGunner={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),BubbleGunner;!function(e){!function(t){var n=createjs.Bitmap,a=createjs.Tween,r=createjs.Text,i=createjs.Sound,o=function(t){function o(){var a=t.call(this)||this;a._pulseCount=0;var i=new r("GAME OVER","80px Permanent Marker","#F57"),o=i.getBounds();return i.x=e.NormalWidth/2-o.width/2,i.y=30,a.addChild(i),a._refreshButton=new n(e.loader.getResult("refresh")),a._refreshButton.regX=a._refreshButton.getBounds().width/2,a._refreshButton.regY=a._refreshButton.getBounds().height/2,a._refreshButton.x=e.NormalWidth/2,a._refreshButton.y=e.NormalHeight/2,a._refreshButton.on("click",a.dispatchPlayGameEvent,a),a._refreshButton.cursor="pointer",a.addChild(a._refreshButton),a}return __extends(o,t),o.prototype.start=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._pulseIntervalHandle=setInterval(this.pulse.bind(this),60)},o.prototype.dispatchPlayGameEvent=function(){i.play("sound-button"),clearInterval(this._pulseIntervalHandle),this.dispatchEvent(new e.SceneEvent(e.SceneBase.EventChangeScene,e.SceneType.Game))},o.prototype.pulse=function(){var e=.4*Math.cos(.1*this._pulseCount++)+2;a.get(this._refreshButton).to({scaleX:e,scaleY:e,rotation:5*-this._pulseCount},30),this._pulseCount++},o}(e.SceneBase);t.GameOverScene=o}(e.GameOver||(e.GameOver={}))}(BubbleGunner||(BubbleGunner={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),BubbleGunner;!function(e){var t=createjs.Ticker,n=createjs.Touch,a=createjs.EventDispatcher,r=e.Menu.MenuScene,i=e.Game.GameScene,o=e.Menu.PreloadScene,s=e.Help.HelpScene,c=e.GameOver.GameOverScene,l=function(a){function l(e){var t=a.call(this)||this;return t._stage=e,t}return __extends(l,a),l.prototype.startGame=function(){t.framerate=60,t.addEventListener("tick",this._stage),n.enable(this._stage),this._stage.enableMouseOver(10),this.startNewScene(e.SceneType.Preload)},l.prototype.startNewScene=function(t){for(var n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];this._stage.removeAllChildren(),this._currentScene=l.createScene(t),this._stage.addChild(this._currentScene),this._currentScene.on(e.SceneBase.EventChangeScene,this.changeSceneHandler,this),this._currentScene.start()},l.prototype.changeSceneHandler=function(e){this.startNewScene(e.toScene,e.startArgs)},l.createScene=function(t){var n;switch(t){case e.SceneType.Preload:n=new o;break;case e.SceneType.Menu:n=new r;break;case e.SceneType.Help:n=new s;break;case e.SceneType.Game:n=new i;break;case e.SceneType.GameOver:n=new c;break;default:throw new Error("Scene type "+t+" not implemented yet")}return n},l}(a);e.GameManager=l}(BubbleGunner||(BubbleGunner={})),window.addEventListener("load",init);