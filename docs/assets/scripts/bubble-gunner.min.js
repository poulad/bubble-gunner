function resizeCanvas(e,t){window.innerHeight<=window.innerWidth?e.height=e.width=window.innerHeight:e.height=e.width=window.innerWidth,e.width>1200&&(e.height=e.width=1200);var n=e.width/BubbleGunner.NormalWidth;t.scaleX=t.scaleY=n;var i=(window.innerHeight-e.height)/2;e.style.marginTop=i+"px"}function init(){BubbleGunner.canvas=document.getElementById("canvas");var e=new createjs.Stage(BubbleGunner.canvas);window.addEventListener("resize",resizeCanvas.bind(this,BubbleGunner.canvas,e),!1),resizeCanvas(BubbleGunner.canvas,e),new BubbleGunner.GameManager(e).startGame()}var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),BubbleGunner;!function(e){var t=createjs.Container,n=createjs.Event;e.NormalWidth=800,e.NormalHeight=800;var i=function(e){function t(t,n){for(var i=[],a=2;a<arguments.length;a++)i[a-2]=arguments[a];var r=e.call(this,t,void 0,void 0)||this;return r.toScene=n,r.startArgs=i,r}return __extends(t,e),t}(n);e.SceneEvent=i;var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.EventChangeScene="changeScene",t}(t);e.Scene=a;!function(e){e[e.Preload=0]="Preload",e[e.Menu=1]="Menu",e[e.Help=2]="Help",e[e.Game=3]="Game",e[e.GameOver=4]="GameOver"}(e.SceneType||(e.SceneType={}))}(BubbleGunner||(BubbleGunner={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),BubbleGunner;!function(e){!function(t){var n=createjs.Shape,i=createjs.Text,a=createjs.Tween,r=createjs.LoadQueue,o=createjs.Sound,s=function(t){function s(){var a=t.call(this)||this;return a._circle=new n,a._circle.graphics.setStrokeStyle(5).beginStroke("rgba(200, 200, 200, .4)").beginFill("lightblue").drawCircle(0,0,s.Radius),a._circle.x=e.NormalWidth/2,a._circle.y=e.NormalHeight/2,a._text=new i("0 %","20px Arial","#444"),a._text.x=a._text.y=-100,a.addChild(a._circle,a._text),a}return __extends(s,t),s.prototype.start=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.loader=new r(!0,"assets/"),e.loader.installPlugin(createjs.Sound),o.alternateExtensions=["mp3"],e.loader.on("progress",this.updateProgress,this),e.loader.on("complete",this.changeToMenuScene,this),e.loader.loadManifest([{id:"sound-button",src:"sounds/button.ogg"},{id:"dragon",src:"images/dragon.png"},{id:"dragon-hand",src:"images/dragon-hand.png"},{id:"volcano",src:"images/volcano.png"},{id:"heart",src:"images/heart.png"},{id:"menu-volcano",src:"images/volcano-menu.png"},{id:"menu-dragon",src:"images/dragon-menu.png"},{id:"menu-start",src:"images/start.png"},{id:"menu-help",src:"images/help.png"},{id:"back",src:"images/back.png"},{id:"pause",src:"images/pause.png"},{id:"refresh",src:"images/refresh.png"},{id:"scoresbar",src:"images/scoresbar.png"},{id:"game-bgm",src:"sounds/bgm.ogg"},{id:"game-bubble-shoot",src:"sounds/bubble-shoot.ogg"},{id:"game-lava-fall",src:"sounds/lava-fall.ogg"}])},s.prototype.updateProgress=function(t){var n=Math.floor(100*t.loaded),i=(this._circle.scaleX+10*n)/100;a.get(this._circle).to({scaleX:i,scaleY:i},150);this._text.text=n+" %",this._text.x=e.NormalWidth/2-this._text.getMeasuredWidth()/2,this._text.y=e.NormalHeight/2-this._text.getMeasuredHeight()/2},s.prototype.changeToMenuScene=function(){var t=this;a.removeTweens(this._circle),a.get(this._circle).to({scaleX:10,scaleY:10},200).call(function(){return setTimeout(function(){return t.dispatchEvent(new e.SceneEvent(e.Scene.EventChangeScene,e.SceneType.Menu))},400)})},s.Radius=50,s}(e.Scene);t.PreloadScene=s}(e.Menu||(e.Menu={}))}(BubbleGunner||(BubbleGunner={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),BubbleGunner;!function(e){!function(t){var n=createjs.Shape,i=createjs.Bitmap,a=createjs.Graphics,r=createjs.Tween,o=createjs.Sound,s=createjs.SpriteSheet,c=createjs.Sprite,l=function(t){function l(){var r=t.call(this)||this,o=(new a).beginFill("lightblue").drawRect(0,0,e.NormalWidth,e.NormalHeight);r.addChild(new n(o));var l=new i(e.loader.getResult("menu-volcano"));r.addChild(l),r._btnStartGame=new i(e.loader.getResult("menu-start")),r._btnStartGame.regX=r._btnStartGame.image.width/2,r._btnStartGame.regY=r._btnStartGame.image.height/2,r._btnStartGame.x=e.NormalWidth/2,r._btnStartGame.y=e.NormalHeight/2,r._btnStartGame.cursor="pointer",setInterval(r.pulse.bind(r),120),r._btnStartGame.on("click",r.onStartButtonClick,r),r.addChild(r._btnStartGame),r._btnHelp=new i(e.loader.getResult("menu-help")),r._btnHelp.x=e.NormalWidth-r._btnHelp.image.width-50,r._btnHelp.y=50,r._btnHelp.cursor="pointer",r._btnHelp.on("click",r.onHelpButtonClick,r),r.addChild(r._btnHelp);var h={images:[e.loader.getResult("menu-dragon")],frames:[[0,0,552,674],[552,0,552,674],[0,0,552,674],[0,674,552,674],[552,674,552,674]],framerate:4,animations:{cheer:[0,2,"run"],runCheer:[3,4,"cheer"],run:[3,4]}};r._dragon=new c(new s(h)),r._dragon.regX=226,r._dragon.regY=337;return r._dragon.x=6*e.NormalWidth/9,r._dragon.y=e.NormalHeight-190,r._dragon.scaleX=r._dragon.scaleY=.4,r.addChild(r._dragon),r}return __extends(l,t),l.prototype.start=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._dragon.on("animationend",this.moveDragon,this),this._dragon.gotoAndPlay("run"),this.moveDragon(void 0)},l.prototype.onStartButtonClick=function(){var t=this;o.play("sound-button"),r.get(this).to({alpha:0,scaleX:10,scaleY:10},2e3).call(function(){t.dispatchEvent(new e.SceneEvent(e.Scene.EventChangeScene,e.SceneType.Game))})},l.prototype.onHelpButtonClick=function(){o.play("sound-button"),this.dispatchEvent(new e.SceneEvent(e.Scene.EventChangeScene,e.SceneType.Help))},l.prototype.moveDragon=function(t){var n=this;if(!t||"cheer"===t.name){console.debug("Dragon running to other side");var i=this._dragon.scaleX>0?3*e.NormalWidth/9:6*e.NormalWidth/9;r.get(this._dragon).to({x:i},2500).call(function(){n._dragon.gotoAndPlay("cheer"),n._dragon.scaleX*=-1})}},l.prototype.pulse=function(){var e=this._btnStartGame.scaleX+.05;e>=1.2&&(e=1),r.get(this._btnStartGame).to({scaleX:e,scaleY:e},110);var t=this._btnHelp.alpha-.08;t<.9&&(t=1),r.get(this._btnHelp).to({alpha:t},110)},l}(e.Scene);t.MenuScene=l}(e.Menu||(e.Menu={}))}(BubbleGunner||(BubbleGunner={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),BubbleGunner;!function(e){!function(t){var n=createjs.Bitmap,i=createjs.Sound,a=function(t){function a(){var i=t.call(this)||this,a=new n(e.loader.getResult("back"));return a.x=30,a.y=30,a.on("click",i.dispatchBackToMenuEvent,i),a.cursor="pointer",a.scaleX=a.scaleY=1.5,i.addChild(a),i}return __extends(a,t),a.prototype.start=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},a.prototype.dispatchBackToMenuEvent=function(){i.play("sound-button"),this.dispatchEvent(new e.SceneEvent(e.Scene.EventChangeScene,e.SceneType.Menu))},a}(e.Scene);t.HelpScene=a}(e.Help||(e.Help={}))}(BubbleGunner||(BubbleGunner={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),BubbleGunner;!function(e){!function(t){function n(e){return e[1].length>0}function i(e,t){return Math.sqrt(Math.pow(e.y-t.y,2)+Math.pow(e.x-t.x,2))}function a(e,t,n){return Math.floor(1e3*i(e,t)/n)}var r=createjs.Shape,o=createjs.Tween,s=createjs.Container,c=createjs.Text,l=createjs.Bitmap,h=createjs.Ease,u=createjs.EventDispatcher,d=createjs.Sound;t.hasCollisions=n,t.findDistance=i,t.getTweenDurationMSecs=a;var p=function(){function e(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this.x=e,this.y=t}return e.prototype.toString=function(){return"("+this.x+" , "+this.y+")"},e}();t.Point=p;var _=function(t){function n(e){var i=t.call(this)||this;return i.graphics.beginFill("lime").drawCircle(0,0,n.Radius),i.x=e.x,i.y=e.y,i.startPoint=e,i}return __extends(n,t),n.prototype.moveTo=function(e){return this.endPoint=e,o.get(this).to({x:this.endPoint.x,y:this.endPoint.y},a(this.startPoint,this.endPoint,n.Speed)).call(this.fallCallback.bind(this))},n.prototype.continueFall=function(){o.removeTweens(this);var t=new p(this.endPoint.x,e.NormalHeight);return this.moveTo(t)},n.prototype.fallCallback=function(){return o.get(this).to({alpha:.3},300).call(this.dispatchEvent.bind(this,n.EventFell))},n.EventFell="fell",n.Radius=22,n.Speed=330,n}(r),g=function(e){function t(n){var i=e.call(this)||this;return i.graphics.beginFill("red").drawRect(0,0,t.Width,t.Height),i.startPoint=new p(n,0),i.x=i.startPoint.x,i.y=i.startPoint.y,i}return __extends(t,e),t.prototype.moveTo=function(e){var n=this;return this.endPoint=e,o.get(this).to({x:this.endPoint.x,y:this.endPoint.y},a(this.startPoint,this.endPoint,t.Speed)).call(function(){return n.dispatchEvent(new Event(t.EventFell))})},t.EventFell="fell",t.Speed=400,t.Width=25,t.Height=20,t}(r),v=function(t){function n(e,i){var a=t.call(this)||this;return a.containsAnimal=!1,a._pulseCount=0,a.graphics.beginFill("rgba(255, 255, 255, .1)").beginStroke("rgba(255, 255, 255, .8)").drawCircle(0,0,n.Radius),a.startPoint=e,a.x=a.startPoint.x,a.y=a.startPoint.y,a.endPoint=i,a}return __extends(n,t),n.prototype.move=function(){return this.on("tick",this.handleTick,this),this.updateEndPoint(),o.get(this).to({x:this.endPoint.x,y:this.endPoint.y},a(this.startPoint,this.endPoint,n.Speed)).call(this.dispatchEvent.bind(this,new Event(n.EventAscended)))},n.prototype.takeAnimal=function(e){return this._animal=e,this.containsAnimal=!0,this.x=this._animal.x,this.y=this._animal.y,o.removeTweens(this),o.removeTweens(this._animal),this.startPoint=new p(this.x,this.y),this.endPoint=new p(this.x,-_.Radius),o.get(this).to({x:this.endPoint.x,y:this.endPoint.y},a(this.startPoint,this.endPoint,n.AscendingSpeed)).call(this.dispatchEvent.bind(this,new Event(n.EventRescuedAnimal)))},n.prototype.getAnimal=function(){return this._animal},n.prototype.pop=function(){return o.removeTweens(this),this.containsAnimal&&this._animal.continueFall(),o.get(this).to({alpha:0}).call(this.dispatchEvent.bind(this,new Event(n.EventPopped)))},n.prototype.handleTick=function(){(this.x<0-n.Radius*this.scaleX||e.NormalWidth+n.Radius*this.scaleX<this.x)&&this.dispatchEvent(new Event(n.EventAscended)),this.containsAnimal&&(this._animal.y=this.y),this.pulse()},n.prototype.pulse=function(){var e=.4*Math.cos(.1*this._pulseCount++)+.6;o.get(this).to({alpha:e}),this._pulseCount++},n.prototype.updateEndPoint=function(){var t=0;this.endPoint.y>=this.startPoint.y&&(t=e.NormalHeight);var n=(this.startPoint.y-this.endPoint.y)/(this.startPoint.x-this.endPoint.x),i=this.endPoint.y-n*this.endPoint.x;this.endPoint.y=t,this.endPoint.x=(this.endPoint.y-i)/n},n.EventPopped="popped",n.EventAscended="ascended",n.EventRescuedAnimal="rescued",n.Radius=28,n.Speed=450,n.AscendingSpeed=100,n}(r),f=(function(e){function t(){var t=e.call(this,"assets/images/dragon-hand.png")||this;return t.regX=426,t.regY=110,t}__extends(t,e)}(l),function(t){function n(){var n=t.call(this)||this;return n.originalWidth=140,n.originalHeight=408,n._canShoot=!0,n._body=new l(e.loader.getResult("dragon")),n._hand=new l(e.loader.getResult("dragon-hand")),n._hand.regX=426,n._hand.regY=110,n._hand.x=250,n._hand.y=180,n.addChild(n._body,n._hand),n}return __extends(n,t),n.prototype.shootBubbleTo=function(e){if(this._canShoot){this.aimGunToPoint(e);var t=this.getGunMuzzleStagePoint(),i=new v(t,e);console.debug("Shooting bubble from: "+t);var a=i.scaleX;return i.scaleX=i.scaleY=.1,o.get(i).to({scaleX:a,scaleY:a},150,h.bounceOut),this.setGunFireDelay(n.FireRate),i}},n.prototype.setGunFireDelay=function(e){var t=this;clearTimeout(this._gunFireTimeoutHandle),this._canShoot=!1,this._gunFireTimeoutHandle=setTimeout(function(){void 0!=t&&(t._canShoot=!0)},e)},n.prototype.aimGun=function(e){var t=e.target,n=new p(e.stageX/t.scaleX,e.stageY/t.scaleY);this.aimGunToPoint(n)},n.prototype.isReadyToShoot=function(){return this._canShoot},n.prototype.aimGunToPoint=function(e){var t=this.getHandRegStagePoint();t.x<e.x?this.scaleX=-Math.abs(this.scaleX):this.scaleX=Math.abs(this.scaleX),t=this.getHandRegStagePoint();var n=e.y-t.y,i=e.x-t.x,a=Math.atan(n/i)/Math.PI*180;this.scaleX<0&&(a*=-1),a<-10&&(a=-10),this._hand.rotation=a},n.prototype.getHandRegStagePoint=function(){return new p(this.x+this._hand.x*this.scaleX,this.y+this._hand.y*this.scaleY)},n.prototype.getGunMuzzleStagePoint=function(){var e=new p,t=Math.PI+this._hand.rotation*Math.PI/180;this.scaleX<0&&(t=2*Math.PI-t);var n=426*this.scaleX,i=this.getHandRegStagePoint();return e.x=i.x+n*Math.cos(t),e.y=i.y+n*Math.sin(t),e},n.FireRate=650,n}(s)),m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.currentLevel=1,t}return __extends(t,e),t.prototype.getLevelMaxScore=function(e){return void 0==e&&(e=this.currentLevel),t.Level1MaxScore*e},t.prototype.setScore=function(e){this.currentLevel<3&&e>this.getLevelMaxScore()&&(this.currentLevel++,this.dispatchEvent(new Event(t.EventLevelChanged)))},t.EventLevelChanged="levelChanged",t.Level1MaxScore=4,t}(u),b=function(t){function n(n,i,a){void 0===i&&(i=0),void 0===a&&(a=4);var o=t.call(this)||this;o._levelManager=n,o._score=i,o._remainingLives=a,o._hearts=[];o._mask=new l(e.loader.getResult("scoresbar")),o.addChild(o._mask),o.setChildIndex(o._mask,2),o._bar=new r,o._bar.graphics.beginFill("yellow").drawRect(0,0,.72,o._mask.getBounds().height-6),o._bar.scaleX=0,o._bar.x=3,o._bar.y=3,o.addChild(o._bar),o.setChildIndex(o._bar,1),o._scoreText=new c(o._score.toString(),"20px Arial","white"),o._scoreText.x=o._mask.getBounds().width+10,o._scoreText.y=0,o.addChild(o._scoreText),o.setChildIndex(o._scoreText,1);for(var s=0;s<a;s++){var h=new l(e.loader.getResult("heart"));h.scaleX=h.scaleY=.3,h.x=20*s,h.y=o._mask.getBounds().height+8,o._hearts.push(h),o.addChild(h)}return o}return __extends(n,t),n.prototype.increaseScore=function(){this.setScore(this._score+1)},n.prototype.decreaseRemainingLives=function(){this.setRemainingLives(this._remainingLives-1)},n.prototype.setScore=function(e){this._score=e,this._levelManager.setScore(this._score);var t=this._score/this._levelManager.getLevelMaxScore()*100;t=t>=100?100:t,o.get(this._bar).to({scaleX:t},300),this._scoreText.text=this._score.toString()},n.prototype.getScore=function(){return this._score},n.prototype.setRemainingLives=function(e){var t=this;this._remainingLives=e,this._hearts.filter(function(t,n){return n+1>e}).forEach(function(e){o.get(e).to({alpha:0,x:-50},300).call(function(){t.removeChild(e),t._hearts.pop(),console.debug("Hearts left: "+t._hearts.length),t._hearts.length<=0&&t.dispatchEvent(new Event(n.EventNoLifeLeft))})})},n.prototype.getRemainingLives=function(){return this._remainingLives},n.EventNoLifeLeft="noLifeLeft",n}(s),y=function(t){function a(){var n=t.call(this)||this;n._levelManager=new m,n._animals=[],n._bubbles=[],n._lavaPieces=[],n._isShapesLockFree=!0;var i=new r;i.graphics.beginFill("#222").drawRect(0,0,e.NormalWidth,e.NormalHeight),i.x=i.y=0,n.addChild(i);var a=new l(e.loader.getResult("volcano"));return n.addChild(a),n._scoresBar=new b(n._levelManager),n._scoresBar.x=10,n._scoresBar.y=10,n._scoresBarListener=n._scoresBar.on(b.EventNoLifeLeft,n.changeGameScene.bind(n,e.SceneType.GameOver)),n.addChild(n._scoresBar),n.setChildIndex(n._scoresBar,3),n._dragon=new f,n._dragon.scaleX=n._dragon.scaleY=.3,n._dragon.x=e.NormalWidth/2,n._dragon.y=e.NormalHeight-n._dragon.originalHeight*n._dragon.scaleY-40,n.addChild(n._dragon),n.setChildIndex(n._dragon,3),n._pauseButton=new l(e.loader.getResult("pause")),n._pauseButton.x=30,n._pauseButton.y=e.NormalHeight-n._pauseButton.getBounds().height-30,n._pauseButton.cursor="pointer",n._pauseButtonListener=n._pauseButton.on("click",function(){d.play("sound-button"),n.changeGameScene(e.SceneType.Menu)},n),n.addChild(n._pauseButton),n.setChildIndex(n._pauseButton,3),n._tickListener=n.on("tick",n.handleTick,n),n}return __extends(a,t),a.prototype.start=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.alpha=-1,this.scaleX=this.scaleY=10,o.get(this).to({scaleX:1,scaleY:1,alpha:1},1e3),this._mouseMoveListener=this.stage.on("stagemousemove",this._dragon.aimGun,this._dragon),this._mouseUpListener=this.stage.on("stagemouseup",this.handleClick,this),this._levelListener=this._levelManager.on(m.EventLevelChanged,this.showLevelChangedDemo,this),this.playBackgroundMusic(),this.startRain()},a.prototype.startRain=function(){this._animalRainInterval=setInterval(this.handleAnimalRainInterval.bind(this),3e3),this._lavaRainInterval=setInterval(this.handleLavaRainInterval.bind(this),4e3)},a.prototype.stopRain=function(){clearInterval(this._animalRainInterval),clearInterval(this._lavaRainInterval)},a.prototype.changeGameScene=function(t){switch(this.off("tick",this._tickListener),this.stage.off("stagemousemove",this._mouseMoveListener),this.stage.off("stagemouseup",this._mouseUpListener),this._scoresBar.off(b.EventNoLifeLeft,this._scoresBarListener),this._bgMusic.off("complete",this._bgMusicListener),this._pauseButton.off("click",this._pauseButtonListener),this._levelManager.off(m.EventLevelChanged,this._levelListener),this.stopRain(),this._bgMusic.stop(),this.removeAllChildren(),this._bubbles.length=this._animals.length=this._lavaPieces.length=0,t){case e.SceneType.Menu:this.dispatchEvent(new e.SceneEvent(e.Scene.EventChangeScene,e.SceneType.Menu));break;case e.SceneType.GameOver:this.dispatchEvent(new e.SceneEvent(e.Scene.EventChangeScene,e.SceneType.GameOver));break;default:throw new Error("Invalid scene type: "+t)}},a.prototype.handleAnimalRainInterval=function(){var t=this,n=new _(new p(a.getRandomX(),0));this.lockShapes(function(){t._animals.push(n)}),this.addChild(n),this.setChildIndex(n,2),console.debug(this._animals),n.on(_.EventFell,this.handleAnimalFall,this),n.moveTo(new p(a.getRandomX(),e.NormalHeight))},a.prototype.handleLavaRainInterval=function(){var t=this,n=function(){var n=new g(a.getRandomX());t.lockShapes(function(){return t._lavaPieces.push(n)}),t.addChild(n),t.setChildIndex(n,2),console.debug(t._lavaPieces),n.on(g.EventFell,function(){return t.removeShape(n)},t),n.moveTo(new p(a.getRandomX(),e.NormalHeight)),d.play("game-lava-fall")};switch(this._levelManager.currentLevel){case 1:break;case 2:n();break;case 3:n(),setTimeout(n,1200);break;default:throw"Invalid level: "+this._levelManager.currentLevel}},a.prototype.handleClick=function(e){var t=this;if(this._dragon.isReadyToShoot()){var n=this._pauseButton.globalToLocal(this.stage.mouseX,this.stage.mouseY);if(!this._pauseButton.hitTest(n.x,n.y)){var i=new p(e.stageX/this.stage.scaleX,e.stageY/this.stage.scaleY),a=this._dragon.shootBubbleTo(i);this.lockShapes(function(){t._bubbles.push(a)}),this.addChild(a),this.setChildIndex(a,2),console.debug(this._bubbles),a.on(v.EventPopped,function(){return t.removeShape(a)},this),a.on(v.EventAscended,function(){return t.removeShape(a)},this),a.on(v.EventRescuedAnimal,function(){t._scoresBar.increaseScore(),t.removeShape(a.getAnimal(),a)},this),d.play("game-bubble-shoot"),a.move()}}},a.prototype.playBackgroundMusic=function(){this._bgMusic=d.play("game-bgm"),this._bgMusicListener=this._bgMusic.on("complete",this.playBackgroundMusic,this),this._bgMusic.volume=.5,this._bgMusic.pan=.5},a.prototype.handleAnimalFall=function(e){var t=e.target;this._scoresBar.decreaseRemainingLives(),this.removeShape(t)},a.prototype.showLevelChangedDemo=function(){var t=this;this.stopRain();var n;n=setInterval(function(){0===t._animals.length&&(clearInterval(n),t._levelText=new c(void 0,"bold 24px serif","yellow"),t._levelText.text="Level "+t._levelManager.currentLevel,t._levelText.regX=t._levelText.getMeasuredWidth()/2,t._levelText.regY=t._levelText.getMeasuredHeight()/2,t._levelText.x=e.NormalWidth/2,t._levelText.y=e.NormalHeight/2,o.get(t._levelText).to({scaleX:5,scaleY:5,alpha:0},2500).call(function(){t.removeChild(t._levelText),t.startRain()}),t.addChild(t._levelText))},200)},a.prototype.removeShape=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.lockShapes(function(){for(var n=0,i=t;n<i.length;n++)!function(t){e.removeChild(t),t instanceof v?(e._bubbles=e._bubbles.filter(function(e){return e!==t&&void 0!=e}),console.debug(e._bubbles)):t instanceof _?(e._animals=e._animals.filter(function(e){return e!==t&&void 0!=e}),console.debug(e._animals)):t instanceof g?(e._lavaPieces=e._lavaPieces.filter(function(e){return e!==t&&void 0!=e}),console.debug(e._lavaPieces)):console.warn("Unknown type to remove: "+t)}(i[n])})},a.prototype.handleTick=function(){var e=this;this._isShapesLockFree&&this.lockShapes(function(){e._bubbles.filter(e.isCollidingWithAnyLava(e._lavaPieces)).forEach(function(t){t.pop(),console.debug("hit lava!"),e._dragon.setGunFireDelay(1500)}),e._bubbles.filter(e.isNotCollidingWithOtherBubbles(e._bubbles)).map(function(t){return[t,e.findAnimalsCollidingWithBubble(t,e._animals)]}).filter(n).map(function(e){return[e[0],e[1][0]]}).forEach(function(e){return e[0].takeAnimal(e[1])})})},a.getRandomX=function(){return 324627938*Math.random()%e.NormalWidth},a.prototype.lockShapes=function(e){this._isShapesLockFree=!1,e(),this._isShapesLockFree=!0},a.prototype.isNotCollidingWithOtherBubbles=function(e){var t=2*v.Radius;return function(n){var a=new p(n.x,n.y);return 0===e.filter(function(e){return e!==n}).filter(function(e){var n=new p(e.x,e.y);return i(a,n)<=t}).length}},a.prototype.findAnimalsCollidingWithBubble=function(e,t){var n=v.Radius+_.Radius,a=new p(e.x,e.y);return t.filter(function(e){var t=new p(e.x,e.y);return i(a,t)<=n})},a.prototype.isCollidingWithAnyLava=function(e){return function(t){return e.filter(function(e){return Math.sqrt(Math.pow(t.y-e.y,2)+Math.pow(t.x-e.x,2))<30}).length>0}},a}(e.Scene);t.GameScene=y}(e.Game||(e.Game={}))}(BubbleGunner||(BubbleGunner={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),BubbleGunner;!function(e){!function(t){var n=createjs.Bitmap,i=createjs.Tween,a=createjs.Text,r=createjs.Sound,o=function(t){function o(){var i=t.call(this)||this;i._pulseCount=0;var r=new a("GAME OVER","bold 80px Arial","#f57"),o=r.getBounds();return r.x=e.NormalWidth/2-o.width/2,r.y=30,i.addChild(r),i._refreshButton=new n(e.loader.getResult("refresh")),i._refreshButton.regX=i._refreshButton.getBounds().width/2,i._refreshButton.regY=i._refreshButton.getBounds().height/2,i._refreshButton.x=e.NormalWidth/2,i._refreshButton.y=e.NormalHeight/2,i._refreshButton.on("click",i.dispatchPlayGameEvent,i),i._refreshButton.cursor="pointer",i.addChild(i._refreshButton),i}return __extends(o,t),o.prototype.start=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._pulseIntervalHandle=setInterval(this.pulse.bind(this),60)},o.prototype.dispatchPlayGameEvent=function(){r.play("sound-button"),clearInterval(this._pulseIntervalHandle),this.dispatchEvent(new e.SceneEvent(e.Scene.EventChangeScene,e.SceneType.Game))},o.prototype.pulse=function(){var e=.4*Math.cos(.1*this._pulseCount++)+2;i.get(this._refreshButton).to({scaleX:e,scaleY:e,rotation:5*-this._pulseCount},30),this._pulseCount++},o}(e.Scene);t.GameOverScene=o}(e.GameOver||(e.GameOver={}))}(BubbleGunner||(BubbleGunner={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),BubbleGunner;!function(e){var t=createjs.Ticker,n=createjs.Touch,i=createjs.EventDispatcher,a=e.Menu.MenuScene,r=e.Game.GameScene,o=e.Menu.PreloadScene,s=e.Help.HelpScene,c=e.GameOver.GameOverScene,l=function(i){function l(e){var t=i.call(this)||this;return t._stage=e,t}return __extends(l,i),l.prototype.startGame=function(){t.framerate=60,t.addEventListener("tick",this._stage),n.enable(this._stage),this._stage.enableMouseOver(10),this.startNewScene(e.SceneType.Preload)},l.prototype.startNewScene=function(t){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];this._stage.removeAllChildren(),this._currentScene=l.createScene(t),this._stage.addChild(this._currentScene),this._currentScene.on(e.Scene.EventChangeScene,this.changeSceneHandler,this),this._currentScene.start()},l.prototype.changeSceneHandler=function(e){this.startNewScene(e.toScene,e.startArgs)},l.createScene=function(t){var n;switch(t){case e.SceneType.Preload:n=new o;break;case e.SceneType.Menu:n=new a;break;case e.SceneType.Help:n=new s;break;case e.SceneType.Game:n=new r;break;case e.SceneType.GameOver:n=new c;break;default:throw new Error("Scene type "+t+" not implemented yet")}return n},l}(i);e.GameManager=l}(BubbleGunner||(BubbleGunner={})),window.addEventListener("load",init);